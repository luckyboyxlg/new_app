<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>四、hook-常用加密-抓包app - App逆向在线笔记</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="./css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href="index.html" target="_blank" class="custom-link">App逆向在线笔记</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="index.html">
<a href="index.html">Welcome to Lucky App逆向</a>
<li class="chapter" data-path="day01-%E5%BC%80%E7%8F%AD.html">
<a href="day01-%E5%BC%80%E7%8F%AD.html">一、前期准备</a>
<li class="chapter" data-path="day02-adb.html">
<a href="day02-adb.html">二、adb</a>
<li class="chapter" data-path="day03-%E6%8A%93%E5%8C%85%E5%92%8C%E5%8F%8D%E7%BC%96%E8%AF%91.html">
<a href="day03-%E6%8A%93%E5%8C%85%E5%92%8C%E5%8F%8D%E7%BC%96%E8%AF%91.html">三、抓包和反编译</a>
<li class="chapter active" data-path="day04-hook-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86-%E6%8A%93%E5%8C%85app.html">
<a href="day04-hook-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86-%E6%8A%93%E5%8C%85app.html">四、hook-常用加密-抓包app</a>
<li class="chapter" data-path="day05-%E9%80%86x%E6%A1%88%E4%BE%8B.html">
<a href="day05-%E9%80%86x%E6%A1%88%E4%BE%8B.html">五、抓包和逆向案例</a>
<li class="chapter" data-path="day06-java%E5%9F%BA%E7%A1%8001.html">
<a href="day06-java%E5%9F%BA%E7%A1%8001.html">六、java基础-01</a>
<li class="chapter" data-path="day07-java%E5%9F%BA%E7%A1%8002.html">
<a href="day07-java%E5%9F%BA%E7%A1%8002.html">七、java基础02</a>
<li class="chapter" data-path="day08-java%E5%9F%BA%E7%A1%8003.html">
<a href="day08-java%E5%9F%BA%E7%A1%8003.html">八、java基础03</a>
<li class="chapter" data-path="day09-%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%9101.html">
<a href="day09-%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%9101.html">Day09 安卓开发01</a>
<li class="chapter" data-path="day10-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%8002.html">
<a href="day10-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%8002.html">十、安卓开发02</a>
<li class="chapter" data-path="day10%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8.html">
<a href="day10%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8.html">十、安卓基础加密拦截器</a>
<li class="chapter" data-path="day11-C%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85.html">
<a href="day11-C%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85.html">十一、C语言安装与入门</a>
<li class="chapter" data-path="day12-C%E8%AF%AD%E8%A8%80%E5%92%8CJNI%E5%BC%80%E5%8F%91.html">
<a href="day12-C%E8%AF%AD%E8%A8%80%E5%92%8CJNI%E5%BC%80%E5%8F%91.html">十二、C语言和JNI开发</a>
<li class="chapter" data-path="day13-JNI%E5%BC%80%E5%8F%91.html">
<a href="day13-JNI%E5%BC%80%E5%8F%91.html">十三、JNI开发</a>
<li class="chapter" data-path="day14-%E8%BD%A6%E6%99%BA%E8%B5%A2.html">
<a href="day14-%E8%BD%A6%E6%99%BA%E8%B5%A2.html">十四、车智赢</a>
<li class="chapter" data-path="day15-%E8%AF%86%E8%B4%A7app.html">
<a href="day15-%E8%AF%86%E8%B4%A7app.html">十五、识货app</a>
<li class="chapter" data-path="day16-%E5%BE%97%E7%89%A9app.html">
<a href="day16-%E5%BE%97%E7%89%A9app.html">十六、得物app</a>
<li class="chapter" data-path="day17-B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8Fday01.html">
<a href="day17-B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8Fday01.html">十七、B站播放量day01</a>
<li class="chapter" data-path="day18-B%E7%AB%9902.html">
<a href="day18-B%E7%AB%9902.html">十八、B站02</a>
<li class="chapter" data-path="day19-B%E7%AB%9903.html">
<a href="day19-B%E7%AB%9903.html">十九、B站02</a>
<li class="chapter" data-path="day20-%E5%94%AF%E5%93%81%E4%BC%9A01.html">
<a href="day20-%E5%94%AF%E5%93%81%E4%BC%9A01.html">二十、唯品会01</a>
<li class="chapter" data-path="day21-%E5%94%AF%E5%93%81%E4%BC%9A02.html">
<a href="day21-%E5%94%AF%E5%93%81%E4%BC%9A02.html">二十一、唯品会02</a>
<li class="chapter" data-path="day22-DYM.html">
<a href="day22-DYM.html">二十二、DYM</a>
<li class="chapter" data-path="day23-%E9%85%92%E4%BB%99%E7%BD%91.html">
<a href="day23-%E9%85%92%E4%BB%99%E7%BD%91.html">二十三、酒仙网</a>
<li class="chapter" data-path="day24-%E5%8F%B8%E5%B0%8F%E5%AE%9D.html">
<a href="day24-%E5%8F%B8%E5%B0%8F%E5%AE%9D.html">二十四、司小宝</a>
<li class="chapter" data-path="day25-unidbg-%E4%B8%8A.html">
<a href="day25-unidbg-%E4%B8%8A.html">二十五、unidbg-上</a>
<li class="chapter" data-path="day26-unidbg-%E4%B8%AD%E7%AF%87.html">
<a href="day26-unidbg-%E4%B8%AD%E7%AF%87.html">二十六、unidbg-中</a>
<li class="chapter" data-path="day27-unidbg-%E4%B8%8B.html">
<a href="day27-unidbg-%E4%B8%8B.html">二十七、unidbg-下</a>
<li class="chapter" data-path="day28-xhs-%E4%B8%8A.html">
<a href="day28-xhs-%E4%B8%8A.html">二十八、xhs-上</a>
<li class="chapter" data-path="day29-xhs-%E4%B8%8B.html">
<a href="day29-xhs-%E4%B8%8B.html">二十九、xhs-下</a>
<li class="chapter" data-path="day30-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">
<a href="day30-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">三十、无障碍开发</a>
<li class="chapter" data-path="day31-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">
<a href="day31-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">三十一、无障碍image-20240703160302051</a>
<li class="chapter" data-path="day32-%E6%97%A0%E9%9A%9C%E7%A2%8D%E9%83%A8%E7%BD%B2.html">
<a href="day32-%E6%97%A0%E9%9A%9C%E7%A2%8D%E9%83%A8%E7%BD%B2.html">三十二、无障碍项目部署</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="hook-app">四、hook-常用加密-抓包app</h1>
<h1 id="1-hookfrida">1 hook框架frida</h1>
<ul>
<li>说明</li>
</ul>
<p>Hook 框架是一种技术，用于在运行时拦截和修改应用程序的行为
  通过 Hook，你可以劫持应用程序的方法调用、修改参数、篡改返回值等，以达到对应用程序的修改、增强或调试的目的</p>
<ul>
<li>
<p>常见的有</p>
</li>
<li>
<p>Xposed Framework：Xposed 是一个功能强大的开源 Hook 框架，可以在不修改应用程序源代码的情况下，对应用程序进行各种修改。它允许你编写模块来拦截和修改应用程序的方法调用，修改应用程序的行为和逻辑。</p>
</li>
<li>Frida：Frida 是一个跨平台的动态 Hook 框架，支持安卓和其他操作系统。它提供了一个强大的 JavaScript API，可以在运行时对应用程序进行 Hook，包括方法拦截、参数修改、调用注入等。Frida 可以用于安全研究、逆向工程和应用程序调试等方面。</li>
</ul>
<h2 id="11">1.1 下载安装</h2>
<pre><code class="language-python">##### 注意事项####
手机端 装 frida-server端 ----》放手机上
电脑端 转 frida的python模块---》python解释器上
##### 版本必须相同 #####
</code></pre>
<h3 id="111">1.1.1 电脑端安装</h3>
<ul>
<li>安装在python解释器上，两个模块---》建议装在虚拟环境中</li>
</ul>
<p>pip3 install frida        # 最新的  16.2.1
   pip3 install frida-tools  # 最新的  16.3.0</p>
<ul>
<li>
<p>问题解决</p>
</li>
<li>
<p>把报错--》放到搜索引擎中搜---》基本上都能解决</p>
</li>
<li>使用whl文件安装（可能没有最新，更新不及时）
        https://pypi.doubanio.com/simple/frida/
        找到对应你平台的whl文件
        pip install 把下载的文件拖到命令窗口</li>
</ul>
<p><img alt="image-20240313201611060" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20240313201611060.png" /></p>
<h3 id="112-frida-server">1.1.2 手机端安装--frida-server</h3>
<ul>
<li>下载地址</li>
</ul>
<p>https://github.com/frida/frida/releases</p>
<ul>
<li>下载的文件如下图</li>
</ul>
<p>查看手机平台：adb shell getprop ro.product.cpu.abi</p>
<p>arm64-v8a</p>
<ul>
<li>我们下载：frida-server-16.2.1-android-arm64.xz</li>
</ul>
<p>解压（一定要解压，不要把 xz压缩包，放到手机上）</p>
<ul>
<li>上传到手机上</li>
</ul>
<p>adb push ./frida-server-16.2.1-android-arm64 /data/local/tmp/</p>
<ul>
<li>进入到手机查看一下有没有</li>
</ul>
<p><code>python
  adb shell
  su
  cd /data/local/tmp
  ls  # 查看，你们是空的，推送上去，你们就有了</code></p>
<ul>
<li>软件加上执行权限</li>
</ul>
<p><code>python
  ls -al  # 查看当前目录下所有文件和文件夹的详细信息【包含文件的权限】
      rwx rwx rwx
      421 401 401
      rw- rw- rw- # 属主(这个文件所属人)  属组(用户所在的组的其他人)  其他(除了上面的其他人)
      r：read 读权限
      w：write 写权限
      x：执行权限
      刚刚传上来这个文件：拥有者自己只有读写权限，没有执行权限，没有执行权限，不能执行
      我们需要给他加执行权限 所有人都有读写和执行权限
  chmod 777 frida-server-16.2.1-android-arm64
      rw- rw- rw- # 原来文件权限
      rwx rwx rwx # 文件权限变成这样了</code></p>
<p><img alt="image-20240313202257406" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20240313202257406.png" /></p>
<p><img alt="image-20240313202929621" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20240313202929621.png" /></p>
<p><img alt="image-20240313203103404" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20240313203103404.png" /></p>
<h2 id="12-hook-app">1.2 启动并hook-app</h2>
<ul>
<li>在手机端 执行这个可执行文件</li>
</ul>
<p>frida-server</p>
<ul>
<li>
<p>完整的步骤</p>
</li>
<li>
<p>打开cmd</p>
</li>
<li>输入 adb shell</li>
<li>输入 su</li>
<li>cd /data/local/tmp </li>
<li>ls  # 查看当前目录下的文件</li>
<li>./f   # 按 tab键自动补齐，敲回车卡在那，就表示运行起来了</li>
<li>
<p>ctrl -c 是关闭</p>
</li>
<li>
<p>如果保措处理</p>
</li>
<li>
<p>重启手机 --》 解决90%</p>
</li>
<li>
<p>运行 adb shell setenforce 0</p>
</li>
<li>
<p>配置端口转发</p>
</li>
<li>
<p>方式一：直接在命令行中敲</p>
<p><code>python
adb forward tcp:27042 tcp:27042
adb forward tcp:27043 tcp:27043</code></p>
</li>
<li>
<p>方式二：使用python运行（我都用这种，跟上面完全一样）</p>
<p><code>python
import subprocess
subprocess.getoutput("adb forward tcp:27042 tcp:27042")
subprocess.getoutput("adb forward tcp:27043 tcp:27043")</code></p>
</li>
</ul>
<p><img alt="image-20230615163240601" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230615163240601.png" /></p>
<h3 id="121-python-">1.2.1 编写python代码-打印手机中进程</h3>
<pre><code class="language-python"># 枚举手机上的所有进程 &amp; 前台进程
import frida
# 获取设备信息
rdev = frida.get_remote_device()
# 枚举所有的进程
processes = rdev.enumerate_processes()
for process in processes:
    print(process)
# Process(pid=5852, name=&quot;拼多多&quot;, parameters={})   进程id号，应用名字，应用包名(后面会用到)
# Process(pid=7489, name=&quot;com.google.android.gms.unstable&quot;, parameters={})

print('-----------------')
# 获取在前台运行的APP
front_app = rdev.get_frontmost_application()
print(front_app)

# 没做端口转发就会报图下错误
</code></pre>
<p><img alt="image-20240313205324508" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20240313205324508.png" /></p>
<h2 id="13-hook">1.3 hook某智赢加密算法</h2>
<pre><code class="language-python"># 1 手机端启动 frida-server  ---》咱们启动了
# 2 电脑端做端口转发---》做了
# 3 写python脚本---》暂时先不用关注脚本是啥意思
# 4 安装被hook的app--》车智赢--》启动app--》app在前台运行--》下载最新也没问题
# 5 右键运行 python脚本---卡住
# 6 在手机端操作app的登录功能---》电脑端控制台就会有打印
</code></pre>
<h3 id="131-hook-">1.3.1 hook-车智赢脚本</h3>
<pre><code class="language-python">import frida
import sys
# 连接手机设备
rdev = frida.get_remote_device()
# 包名：com.che168.autotradercloud
# 车智赢+
session = rdev.attach(&quot;车智赢+&quot;)
scr = &quot;&quot;&quot;
Java.perform(function () {
    //找到类 反编译的首行+类名：com.autohome.ahkit.utils下的
    var SecurityUtil = Java.use(&quot;com.autohome.ahkit.utils.SecurityUtil&quot;);

    //替换类中的方法
    SecurityUtil.encodeMD5.implementation = function(str){
        console.log(&quot;参数：&quot;,str);
        var res = this.encodeMD5(str); //调用原来的函数
        console.log(&quot;返回值：&quot;,res);
        return res;
    }
});
&quot;&quot;&quot;

script = session.create_script(scr)

def on_message(message, data):
    print(message, data)

script.on(&quot;message&quot;, on_message)
script.load()
sys.stdin.read()

</code></pre>
<h2 id="14-python-hook">1.4 python hook方式</h2>
<pre><code class="language-python"># Spawn 方式适应场景：Spawn 方式是在目标应用程序启动时直接注入 Frida 的 Agent 代码
# 只要一运行---》app会自动重启--》直接就把frida注入到程序中去了
需要在应用程序启动的早期阶段进行 Hook。
需要访问和修改应用程序的内部状态，例如应用程序的全局变量、静态变量等。
需要 Hook 应用程序的初始化过程，以实现对应用程序的自定义初始化逻辑。
需要在应用程序的上下文中执行代码，并与其他模块或库进行交互。



# Attach 方式适应场景：Attach 方式是在目标应用程序已经运行的过程中动态地连接并注入 Frida 的 Agent 代码
# 追加方案---》app运行了--》我们再运行hook脚本
# 缺点--它不能hook，app一运行时执行的方法
需要对已经运行的应用程序进行 Hook，即动态地连接到正在运行的进程。
需要在应用程序运行时拦截和修改特定的方法调用。
需要实时监视和修改应用程序的行为，例如参数修改、返回值篡改等。
需要对应用程序进行调试和分析，以查找潜在的问题和漏洞。


# spanw方案是在app运行一开始就hook--》它能hook更早期的方法
# attach方案，在app运行后，再进行hook--》只能hook，某个操作对应的方法
</code></pre>
<h3 id="141-attach">1.4.1 attach方案</h3>
<ul>
<li>代码</li>
</ul>
<p>```python
  import frida
  import sys
  # 连接手机设备
  rdev = frida.get_remote_device()
  # 包名：com.che168.autotradercloud
  # 车智赢+
  session = rdev.attach("车智赢+")
  scr = """
  Java.perform(function () {
      //找到类 反编译的首行+类名：com.autohome.ahkit.utils下的
      var SecurityUtil = Java.use("com.autohome.ahkit.utils.SecurityUtil");</p>
<pre><code>  //替换类中的方法
  SecurityUtil.encodeMD5.implementation = function(str){
      console.log("参数：",str);
      var res = this.encodeMD5(str); //调用原来的函数
      console.log("返回值：",res);
      return res;
  }
</code></pre>
<p>});
  """</p>
<p>script = session.create_script(scr)</p>
<p>def on_message(message, data):
      print(message, data)</p>
<p>script.on("message", on_message)
  script.load()
  sys.stdin.read()</p>
<p>```</p>
<h3 id="142-spwan">1.4.2 spwan方案</h3>
<ul>
<li>代码</li>
</ul>
<p>```python
  import frida
  import sys</p>
<p>rdev = frida.get_remote_device()
  # 不是放app名字了，放的是app的包名
  pid = rdev.spawn(["com.che168.autotradercloud"])
  session = rdev.attach(pid)
  ## 上面是固定的，以后只要改app的包名即可
  scr = """
  Java.perform(function () {
      var SecurityUtil = Java.use("com.autohome.ahkit.utils.SecurityUtil");
      SecurityUtil.encodeMD5.implementation = function(str){
          console.log("明文：",str);
          var res = this.encodeMD5(str);
          console.log("md5加密结果=",res);
          return res;
      }
  });
  """</p>
<p>## 以下都是固定的
  script = session.create_script(scr)
  def on_message(message, data):
      print(message, data)</p>
<p>script.on("message", on_message)
  script.load()
  rdev.resume(pid)
  sys.stdin.read()
  ```</p>
<h3 id="143">1.4.3 俩种区别</h3>
<h5 id="fridaattach"><strong>frida.attach()</strong></h5>
<ul>
<li><strong>用途</strong>：用于连接到一个已经运行的应用程序进程。</li>
<li><strong>行为</strong>：<code>attach()</code> 方法会尝试找到并附加到指定名称或PID的现有进程。如果找不到匹配的进程，则会抛出异常。</li>
<li>优点</li>
<li>不会中断应用的正常启动流程。</li>
<li>对于那些启动时立即执行关键操作的应用非常有用，因为你可以确保在这些操作发生之前就已附加。</li>
<li>缺点</li>
<li>如果应用没有运行，则无法附加。</li>
<li>不能控制应用启动时的行为。</li>
</ul>
<h5 id="fridaspawn"><strong>frida.spawn()</strong></h5>
<ul>
<li><strong>用途</strong>：用于启动一个应用程序，并在启动后立即附加到它。</li>
<li><strong>行为</strong>：<code>spawn()</code> 方法会启动一个新的进程，并暂停它直到你调用 <code>resume(pid)</code> 来恢复其执行。这样可以在进程启动的早期阶段插入钩子（hook），从而确保所有后续的函数调用都可以被监控。</li>
<li>优点</li>
<li>可以完全控制应用的启动过程。</li>
<li>确保在应用开始执行任何逻辑之前就已经附加了Frida脚本。</li>
<li>缺点</li>
<li>需要手动恢复进程（使用 <code>resume(pid)</code>），否则应用将保持暂停状态。</li>
<li>某些应用可能有反调试机制，可能会检测到这种启动方式并采取措施。</li>
</ul>
<h2 id="15-js-hook">1.5 js hook方式</h2>
<h3 id="151-js-attach-hook">1.5.1 js 的attach-hook方案</h3>
<pre><code class="language-js">Java.perform(function () {
    var SecurityUtil = Java.use(&quot;com.autohome.ahkit.utils.SecurityUtil&quot;);
    SecurityUtil.encodeMD5.implementation = function(str){
        console.log(&quot;明文：&quot;,str);
        var res = this.encodeMD5(str);
        console.log(&quot;md5加密结果=&quot;,res);
        return res;
    }
});

// attach 方案：frida -UF -l 4-js-hook方案.js   
// 不需要写跟应用(app)相关的东西---》因为app现在正在前台运行
</code></pre>
<h3 id="152-jsspwan-hook">1.5.2 js的spwan-hook方案</h3>
<pre><code class="language-js">Java.perform(function () {
    var SecurityUtil = Java.use(&quot;com.autohome.ahkit.utils.SecurityUtil&quot;);
    SecurityUtil.encodeMD5.implementation = function(str){
        console.log(&quot;明文：&quot;,str);
        var res = this.encodeMD5(str);
        console.log(&quot;md5加密结果=&quot;,res);
        return res;
    }
});
// spawn 方案：
frida -U -f com.che168.autotradercloud -l 4-js-hook方案.js 

// 按 q退出
</code></pre>
<h1 id="2-python">2 常见的加密算法python还原</h1>
<pre><code class="language-python"># 加密分类
1 单向加密：MD5，sha1 
    -摘要算法，固定长度，但是根据加密后的结果反解不出明文

2 对称加密：AES，DES
    -加密和解密使用同一个秘钥

3 非对称加密：RSA，DSA
    -公钥，私钥，加密和解密不使用同一个秘钥
    -公钥加密，私钥解密

4 补充算法：base64 
    -不叫加密--》只是编码
</code></pre>
<h2 id="21-md5">2.1 md5</h2>
<pre><code class="language-python">import hashlib
m = hashlib.md5()
m.update('111111'.encode(&quot;utf8&quot;))
print(m.hexdigest())
</code></pre>
<h2 id="22-sha1">2.2 sha1</h2>
<pre><code class="language-python">import hashlib
sha1 = hashlib.sha1()
data = 'helloword'
sha1.update(data.encode('utf-8'))
sha1_data = sha1.hexdigest()
print(sha1_data)
</code></pre>
<h2 id="23-des">2.3 des加密</h2>
<pre><code class="language-python"># pip3 install pycryptodomex
# DES是一个分组加密算法，典型的DES以64位为分组对数据加密，加密和解密用的是同一个算法。它的密钥长度是56位（因为每个第8 位都用作奇偶校验），密钥可以是任意的56位的数，而且可以任意时候改变。

from Cryptodome.Cipher import DES
key = b'88888888'
data = &quot;hello world&quot;
count = 8 - (len(data) % 8)
plaintext = data + count * &quot;=&quot;
des = DES.new(key, DES.MODE_ECB)
ciphertext = des.encrypt(plaintext.encode())
print(ciphertext)

plaintext = des.decrypt(ciphertext)
plaintext = plaintext[:(len(plaintext)-count)]
print(plaintext)
</code></pre>
<h2 id="24-rsa">2.4 非对称加密-rsa</h2>
<pre><code class="language-python"># 安装模块
pip3 install rsa -i https://pypi.douban.com/simple

import rsa
# 返回 公钥加密、私钥解密
public_key, private_key = rsa.newkeys(1024)
print(public_key)
print(private_key)

# plaintext = b&quot;hello world&quot;
# ciphertext = rsa.encrypt(plaintext, public_key)
# print('公钥加密后：',ciphertext)
# plaintext = rsa.decrypt(ciphertext, private_key)
# print('私钥解密：',plaintext)

### 使用私钥签名
plaintext = b&quot;hello world&quot;
sign_message = rsa.sign(plaintext, private_key, &quot;MD5&quot;)
print('私钥签名后：',sign_message)

## 验证私钥签名
plaintext = b&quot;hello world&quot;
# method = rsa.verify(b&quot;hello world&quot;, sign_message, public_key)
method = rsa.verify(b&quot;hello world1&quot;, sign_message, public_key) # 报错Verification failed
print(method)

</code></pre>
<h2 id="25-base64">2.5 base64</h2>
<pre><code class="language-python">import base64

# 编码
res=base64.b64encode(b'hello world')
print(res)

# 解码
res=base64.b64decode('aGVsbG8gd29ybGQ=')
print(res)
</code></pre>
<h1 id="3">3 抓包破解案例</h1>
<h2 id="31-app">3.1 金树林app</h2>
<h3 id="311">3.1.1 目标</h3>
<pre><code class="language-python">#1 发送手机验证码--》python实现
#2 自动注册--》python注册
#3 自动登录---》获取登录后的token
#4 搜索商品

# app安装到手机上
# 配置好代理

</code></pre>
<h3 id="312">3.1.2 发送短信验证码</h3>
<pre><code class="language-python"># 抓包：
    请求地址：https://miappshop.jshulin.com/memberLogin/phoneCode
    请求方式：get
    请求参数：
        phone   18953675221
        serviceType 6


# python复现
import requests

phone = input('请输入要发送的手机号：')

headers = {
    'user-agent': 'Mozilla/5.0 (Linux; Android 11; Pixel 2 XL Build/RP1A.201005.004.A1; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/83.0.4103.106 Mobile Safari/537.36 uni-app Html5Plus/1.0 (Immersed/28.0)'
}
res = requests.get('https://miappshop.jshulin.com/memberLogin/phoneCode?phone=%s&amp;serviceType=6' % phone,
                   headers=headers)

print(res.text)
</code></pre>
<h3 id="313">3.1.3 注册功能</h3>
<pre><code class="language-python"># 抓包
    -请求地址：https://miappshop.jshulin.com/memberLogin/memberRegister
    -请求方式：post
    -请求体：{&quot;phone&quot;:&quot;18953675221&quot;,&quot;fid&quot;:&quot;&quot;,&quot;password&quot;:&quot;1111111&quot;,&quot;phoneCode&quot;:&quot;8888&quot;}

# python实现
import requests

headers = {
    'user-agent': 'Mozilla/5.0 (Linux; Android 11; Pixel 2 XL Build/RP1A.201005.004.A1; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/83.0.4103.106 Mobile Safari/537.36 uni-app Html5Plus/1.0 (Immersed/28.0)'
}
# 通过上面的发送验证码拿到--》把验证码放在这里--》执行这个代码就能注册成功
# 解码平台（违法的，尽量不要用）
data = {&quot;phone&quot;: &quot;17717823244&quot;, &quot;fid&quot;: &quot;&quot;, &quot;password&quot;: &quot;lqz12345&quot;, &quot;phoneCode&quot;: &quot;88888&quot;}
res = requests.post('https://miappshop.jshulin.com/memberLogin/memberRegister', json=data, headers=headers)
print(res.text)
</code></pre>
<h3 id="314">3.1.4 登录功能</h3>
<pre><code class="language-python"># 抓包
    -请求地址：https://miappshop.jshulin.com/memberLogin/login
    -请求方式：post
    -请求参数：{&quot;password&quot;:&quot;lqz12345&quot;,&quot;username&quot;:&quot;18953675221&quot;}
# python实现


import requests
headers = {
    'user-agent': 'Mozilla/5.0 (Linux; Android 11; Pixel 2 XL Build/RP1A.201005.004.A1; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/83.0.4103.106 Mobile Safari/537.36 uni-app Html5Plus/1.0 (Immersed/28.0)'
}
data={&quot;password&quot;:&quot;lqz12345&quot;,&quot;username&quot;:&quot;18953675221&quot;}
res=requests.post('https://miappshop.jshulin.com/memberLogin/login',json=data,headers=headers)
print(res.text)

# token 登录信息，以后需要登录后才能访问的接口，必须携带这个token
# eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxNjcwODM4OTQ0MDY3ODU0MzM4IiwiZXhwIjoxNzEwMzQ0MTI4LCJpYXQiOjE3MTAzNDA1MjgsInVzZXJJZCI6IjE2NzA4Mzg5NDQwNjc4NTQzMzgiLCJ1c2VybmFtZSI6IjE4OTUzNjc1MjIxIn0.zQGMUz3jnw3bDxdj-UfUxOJ-pYVi-6SLr_XdALbDUYA
</code></pre>
<h3 id="315">3.1.5 登录后查询商品</h3>
<pre><code class="language-python"># 抓包
    -地址：https://miappshop.jshulin.com/pro/searchByPage
    -请求方式：post
    -请求体：
    {&quot;cityNo&quot;:&quot;&quot;,&quot;keyword&quot;:&quot;酒&quot;,&quot;limit&quot;:10,&quot;orderByContent&quot;:&quot;&quot;,&quot;page&quot;:1,&quot;enabled&quot;:1}
    -请求头：
    Mobile-Token：不带就搜不到，没登录


# python实现
import requests
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
headers = {
    'Mobile-Token':'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxNjcwODM4OTQ0MDY3ODU0MzM4IiwiZXhwIjoxNzEwMzQ0MTI4LCJpYXQiOjE3MTAzNDA1MjgsInVzZXJJZCI6IjE2NzA4Mzg5NDQwNjc4NTQzMzgiLCJ1c2VybmFtZSI6IjE4OTUzNjc1MjIxIn0.zQGMUz3jnw3bDxdj-UfUxOJ-pYVi-6SLr_XdALbDUYA',
    'user-agent': 'Mozilla/5.0 (Linux; Android 11; Pixel 2 XL Build/RP1A.201005.004.A1; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/83.0.4103.106 Mobile Safari/537.36 uni-app Html5Plus/1.0 (Immersed/28.0)'
}

data = {
    &quot;cityNo&quot;: &quot;&quot;,
    &quot;keyword&quot;: &quot;酒&quot;,
    &quot;limit&quot;: 10,
    &quot;orderByContent&quot;: &quot;&quot;,
    &quot;page&quot;: 1,
    &quot;enabled&quot;: 1
}

res = requests.post('https://miappshop.jshulin.com/pro/searchByPage', json=data, headers=headers)
print(res.text)
</code></pre>
<h3 id="316">3.1.6 请求头字符串转字典   查询字符串转字典</h3>
<pre><code class="language-python"># python 脚本--》把字符串转 字典
header = '''
Mobile-Token    eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxNjcwODM4OTQ0MDY3ODU0MzM4IiwiZXhwIjoxNzEwMzQzOTk3LCJpYXQiOjE3MTAzNDAzOTcsInVzZXJJZCI6IjE2NzA4Mzg5NDQwNjc4NTQzMzgiLCJ1c2VybmFtZSI6IjE4OTUzNjc1MjIxIn0.-d6jE4WxH8o_X8o5xMtw0eQ--A_qilWAQpH5rxC66Xw
user-agent  Mozilla/5.0 (Linux; Android 11; Pixel 2 XL Build/RP1A.201005.004.A1; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/83.0.4103.106 Mobile Safari/537.36 uni-app Html5Plus/1.0 (Immersed/28.0)
Content-Type    application/json
Content-Length  81
Host    miappshop.jshulin.com
Connection  Keep-Alive
Accept-Encoding gzip
'''


def header_str_to_dict(header_str):
    res = [item for item in
           header_str.split('\n')]
    res = res[1:len(res) - 1]
    d = {item.split('\t')[0]: item.split('\t')[1] for item in res}
    return d


res = header_str_to_dict(header)
print(res)

# python 脚本把查询字段转成字典
s = 'appId=32&amp;hashSign=8356ebae71a0aa643f87ad4c5691a456&amp;imgUrl=&amp;lat=29.568295&amp;lng=106.559123&amp;loginName=18953675221&amp;nickName=&amp;openId=&amp;place=%E9%87%8D%E5%BA%86&amp;pwd=25d55ad283aa400af464c76d713c07ad&amp;sessionId=392032c5-09c8-4c3c-bb17-16a1dc49f7fc&amp;token=&amp;type='


# 把它转成字典

def query_to_dict(s):
    return {item.split('=')[0]: item.split('=')[1] for item in s.split('&amp;')}


print(query_to_dict(s))

</code></pre>
<h3 id="317-url">3.1.7 url编码和解码</h3>
<pre><code class="language-python">#  %E4%B8%8A%E6%B5%B7
# 中文被url编码了

from urllib import parse
print(parse.quote('上海'))  # %E4%B8%8A%E6%B5%B7
# print(parse.unquote('%E4%B8%8A%E6%B5%B7'))

</code></pre>
<h3 id="318">3.1.8 补充接码平台</h3>
<pre><code class="language-python"># 正常手机发短信，必须使用一个正常的手机--》接手短信---》接受到短信后，手动输入到程序中，完成后续操作

# 使用接码平台（违法的）
    解码平台提供手机号--》在程序中写上它的手机号---》解码平台能收到验证码---》我们通过某个接口调用--》拿到接码平台的验证码

# 免费收费大全
https://w3h5.com/post/619.html

# 例如 接收中国短信（免费的不稳定）
https://www.goinsms.xyz/cn.php
https://smscoders.com/china_phones
# 自行找收费的，注意别被骗，收费的都会带api接口
    -骗你充值，其实不能用
    -不建议大家用


</code></pre>
<p><img alt="image-20230818192506833" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230818192506833.png" /></p>
<p><img alt="image-20230818192521411" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230818192521411.png" /></p>
<p><img alt="image-20230818192534314" src="imgs/day04-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230818192534314.png" /></p>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="./js/main.js"></script>
<script src="search/main.js"></script>
<script src="./js/gitbook.min.js"></script>
<script src="./js/theme.min.js"></script>
</body>
</html>