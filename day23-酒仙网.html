<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>二十三、酒仙网 - App逆向在线笔记</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="./css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href="index.html" target="_blank" class="custom-link">App逆向在线笔记</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="index.html">
<a href="index.html">Welcome to Lucky App逆向</a>
<li class="chapter" data-path="day01-%E5%BC%80%E7%8F%AD.html">
<a href="day01-%E5%BC%80%E7%8F%AD.html">一、前期准备</a>
<li class="chapter" data-path="day02-adb.html">
<a href="day02-adb.html">二、adb</a>
<li class="chapter" data-path="day03-%E6%8A%93%E5%8C%85%E5%92%8C%E5%8F%8D%E7%BC%96%E8%AF%91.html">
<a href="day03-%E6%8A%93%E5%8C%85%E5%92%8C%E5%8F%8D%E7%BC%96%E8%AF%91.html">三、抓包和反编译</a>
<li class="chapter" data-path="day04-hook-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86-%E6%8A%93%E5%8C%85app.html">
<a href="day04-hook-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86-%E6%8A%93%E5%8C%85app.html">四、hook-常用加密-抓包app</a>
<li class="chapter" data-path="day05-%E9%80%86x%E6%A1%88%E4%BE%8B.html">
<a href="day05-%E9%80%86x%E6%A1%88%E4%BE%8B.html">五、抓包和逆向案例</a>
<li class="chapter" data-path="day06-java%E5%9F%BA%E7%A1%8001.html">
<a href="day06-java%E5%9F%BA%E7%A1%8001.html">六、java基础-01</a>
<li class="chapter" data-path="day07-java%E5%9F%BA%E7%A1%8002.html">
<a href="day07-java%E5%9F%BA%E7%A1%8002.html">七、java基础02</a>
<li class="chapter" data-path="day08-java%E5%9F%BA%E7%A1%8003.html">
<a href="day08-java%E5%9F%BA%E7%A1%8003.html">八、java基础03</a>
<li class="chapter" data-path="day09-%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%9101.html">
<a href="day09-%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%9101.html">Day09 安卓开发01</a>
<li class="chapter" data-path="day10-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%8002.html">
<a href="day10-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%8002.html">十、安卓开发02</a>
<li class="chapter" data-path="day10%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8.html">
<a href="day10%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8.html">十、安卓基础加密拦截器</a>
<li class="chapter" data-path="day11-C%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85.html">
<a href="day11-C%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85.html">十一、C语言安装与入门</a>
<li class="chapter" data-path="day12-C%E8%AF%AD%E8%A8%80%E5%92%8CJNI%E5%BC%80%E5%8F%91.html">
<a href="day12-C%E8%AF%AD%E8%A8%80%E5%92%8CJNI%E5%BC%80%E5%8F%91.html">十二、C语言和JNI开发</a>
<li class="chapter" data-path="day13-JNI%E5%BC%80%E5%8F%91.html">
<a href="day13-JNI%E5%BC%80%E5%8F%91.html">十三、JNI开发</a>
<li class="chapter" data-path="day14-%E8%BD%A6%E6%99%BA%E8%B5%A2.html">
<a href="day14-%E8%BD%A6%E6%99%BA%E8%B5%A2.html">十四、车智赢</a>
<li class="chapter" data-path="day15-%E8%AF%86%E8%B4%A7app.html">
<a href="day15-%E8%AF%86%E8%B4%A7app.html">十五、识货app</a>
<li class="chapter" data-path="day16-%E5%BE%97%E7%89%A9app.html">
<a href="day16-%E5%BE%97%E7%89%A9app.html">十六、得物app</a>
<li class="chapter" data-path="day17-B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8Fday01.html">
<a href="day17-B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8Fday01.html">十七、B站播放量day01</a>
<li class="chapter" data-path="day18-B%E7%AB%9902.html">
<a href="day18-B%E7%AB%9902.html">十八、B站02</a>
<li class="chapter" data-path="day19-B%E7%AB%9903.html">
<a href="day19-B%E7%AB%9903.html">十九、B站02</a>
<li class="chapter" data-path="day20-%E5%94%AF%E5%93%81%E4%BC%9A01.html">
<a href="day20-%E5%94%AF%E5%93%81%E4%BC%9A01.html">二十、唯品会01</a>
<li class="chapter" data-path="day21-%E5%94%AF%E5%93%81%E4%BC%9A02.html">
<a href="day21-%E5%94%AF%E5%93%81%E4%BC%9A02.html">二十一、唯品会02</a>
<li class="chapter" data-path="day22-DYM.html">
<a href="day22-DYM.html">二十二、DYM</a>
<li class="chapter active" data-path="day23-%E9%85%92%E4%BB%99%E7%BD%91.html">
<a href="day23-%E9%85%92%E4%BB%99%E7%BD%91.html">二十三、酒仙网</a>
<li class="chapter" data-path="day24-%E5%8F%B8%E5%B0%8F%E5%AE%9D.html">
<a href="day24-%E5%8F%B8%E5%B0%8F%E5%AE%9D.html">二十四、司小宝</a>
<li class="chapter" data-path="day25-unidbg-%E4%B8%8A.html">
<a href="day25-unidbg-%E4%B8%8A.html">二十五、unidbg-上</a>
<li class="chapter" data-path="day26-unidbg-%E4%B8%AD%E7%AF%87.html">
<a href="day26-unidbg-%E4%B8%AD%E7%AF%87.html">二十六、unidbg-中</a>
<li class="chapter" data-path="day27-unidbg-%E4%B8%8B.html">
<a href="day27-unidbg-%E4%B8%8B.html">二十七、unidbg-下</a>
<li class="chapter" data-path="day28-xhs-%E4%B8%8A.html">
<a href="day28-xhs-%E4%B8%8A.html">二十八、xhs-上</a>
<li class="chapter" data-path="day29-xhs-%E4%B8%8B.html">
<a href="day29-xhs-%E4%B8%8B.html">二十九、xhs-下</a>
<li class="chapter" data-path="day30-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">
<a href="day30-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">三十、无障碍开发</a>
<li class="chapter" data-path="day31-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">
<a href="day31-%E6%97%A0%E9%9A%9C%E7%A2%8D.html">三十一、无障碍image-20240703160302051</a>
<li class="chapter" data-path="day32-%E6%97%A0%E9%9A%9C%E7%A2%8D%E9%83%A8%E7%BD%B2.html">
<a href="day32-%E6%97%A0%E9%9A%9C%E7%A2%8D%E9%83%A8%E7%BD%B2.html">三十二、无障碍项目部署</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="_1">二十三、酒仙网</h1>
<h1 id="_2">一 抓包</h1>
<p><img alt="image-20230905155445522" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20230905155445522.png" /></p>
<h1 id="_3">二 功能实现</h1>
<h2 id="21">2.1 密码登录</h2>
<pre><code class="language-python">import uuid
import requests
def login_by_pwd(mobile, password, app_key, device_identify):
    res = requests.post(
        url=&quot;https://newappuser.jiuxian.com/user/loginUserNamePassWd.htm&quot;,

        data={
            &quot;appKey&quot;: app_key,
            &quot;appVersion&quot;: &quot;9.1.13&quot;,
            &quot;areaId&quot;: &quot;2707&quot;,
            &quot;channelCode&quot;: &quot;0&quot;,
            &quot;cpsId&quot;: &quot;tencent&quot;,
            &quot;deviceIdentify&quot;: device_identify,
            &quot;deviceType&quot;: &quot;ANDROID&quot;,
            &quot;deviceTypeExtra&quot;: &quot;0&quot;,
            &quot;equipmentType&quot;: &quot;Pixel 2 XL&quot;,
            &quot;netEnv&quot;: &quot;wifi&quot;,
            &quot;passWord&quot;: password,
            &quot;screenReslolution&quot;: &quot;1440x2712&quot;,
            &quot;supportWebp&quot;: &quot;1&quot;,
            &quot;sysVersion&quot;: &quot;11&quot;,
            &quot;userName&quot;: mobile
        },
        headers={
            &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,
            &quot;secure&quot;: &quot;false&quot;,
        },
        verify=False
    )
    data_dict = res.json()
    print(data_dict)

    token = data_dict['result']['userInfo']['token']
    return token


def run():
    app_key = device_identify = str(uuid.uuid4())
    mobile = &quot;18953675221&quot;
    password = &quot;Lqz12345&quot;

    token = login_by_pwd(mobile, password, app_key, device_identify)

    print(token)


if __name__ == '__main__':
    run()
</code></pre>
<h2 id="22">2.2 验证码登录</h2>
<h3 id="221">2.2.1 获取验证码图片</h3>
<p><img alt="image-20230905163909893" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20230905163909893.png" /></p>
<pre><code class="language-python"># https://newappuser.jiuxian.com/messages/graphCode.htm?appKey=526b9977-be06-38e3-b2f0-da7b41964c09&amp;appVersion=9.1.13&amp;areaId=2707&amp;channelCode=0&amp;cpsId=tencent&amp;deviceIdentify=526b9977-be06-38e3-b2f0-da7b41964c09&amp;deviceType=ANDROID&amp;deviceTypeExtra=0&amp;equipmentType=Pixel+2+XL&amp;lati=31.088975&amp;longi=121.58378&amp;mobile=18953675221&amp;netEnv=wifi&amp;pushToken=AsLMhsufh3YEmpzPv3S5nHhv0pxuModssTVXvf1TSIsp&amp;screenReslolution=1440x2712&amp;supportWebp=1&amp;sysVersion=11&amp;type=4


</code></pre>
<pre><code class="language-python">import base64

image_str = &quot;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&quot;

img = base64.b64decode(image_str)

with open('v1.png', mode='wb') as f:
    f.write(img)
</code></pre>
<h3 id="222">2.2.2 验证码破解方案</h3>
<h4 id="ddddocr">方案一：ddddocr</h4>
<pre><code class="language-python">https://github.com/sml2h3/ddddocr
</code></pre>
<p><img alt="image-20230905164340500" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20230905164340500.png" /></p>
<pre><code class="language-python">import ddddocr

with open(&quot;v1.png&quot;, 'rb') as f:
    img_bytes = f.read()

ocr = ddddocr.DdddOcr(show_ad=False)
code = ocr.classification(img_bytes)

print(code)

'''
pillow的10.0.0版本中，ANTIALIAS方法被删除了
解决办法：

方案一，修改ddddocr的_init_.py文件，将其中的ANTIALIAS替换为新方法：

# image = image.resize((int(image.size[0] * (64 / image.size[1])), 64), Image.ANTIALIAS).convert('L')
image = image.resize((int(image.size[0] * (64 / image.size[1])), 64), Image.LANCZOS).convert('L')



方案二，降级Pillow的版本，比如使用9.5.0版本先卸载，再重新安装

pip uninstall -y Pillow
pip install Pillow==9.5.0

'''
</code></pre>
<h4 id="pytesseract">方案二pytesseract</h4>
<pre><code class="language-python"># pytesseract是基于Python的OCR工具， 底层使用的是Google的Tesseract-OCR 引擎，支持识别图片中的文字，支持jpeg, png, gif, bmp, tiff等图片格式


#### 操作步骤
1 下载安装包：[使用老师提供的]
https://github.com/UB-Mannheim/tesseract/wiki
2 安装，一路下一步
3 选择语言包--至少选择中文和英文
4 安装完成-安装目录是：D:\Program Files\Tesseract-OCR
    -正常加入到环境变量
    -如果没加需要自己加上--》需要加
5 打开cmd执行：
    tesseract
6 使用python操作--安装两个模块
    pip install pytesseract
    pip install Pillow
7 代码实现：做文字识别
import pytesseract
from PIL import Image

image = Image.open(&quot;wwz.png&quot;)
text = pytesseract.image_to_string(image, lang='chi_sim+en')
print(text)



8 识别不带干扰线的验证码
import pytesseract
from PIL import Image

# image = Image.open(&quot;./code01.png&quot;)
image = Image.open(&quot;./code.png&quot;) # 带干扰线的不能识别
# image.show()
text = pytesseract.image_to_string(image)
print(text)
</code></pre>
<p><img alt="image-20230905181957694" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20230905181957694.png" /></p>
<p><img alt="image-20230905182149432" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20230905182149432.png" /></p>
<h4 id="muggle_ocr">方案三：muggle_ocr(麻瓜)</h4>
<pre><code class="language-python">## 操作步骤
# 1 下载麻瓜源码：muggle-ocr-1.0.3.zip
# 2 解压后使用源码安装
python setup.py install

# 3 由于该模块依赖于以下模块，所以可以先安装
pip install opencv-python
pip install tensorflow-intel


### 或者直接在线安装
pip install muggle-ocr -i https://mirrors.aliyun.com/pypi/simple --trusted-host pypi.douban.com

# 4 成功后编写代码
</code></pre>
<pre><code class="language-python">import muggle_ocr
from muggle_ocr import ModelType
# 二进制 模式打开文件
with open(r&quot;./oneline.png&quot;, &quot;rb&quot;) as f:
# with open(r&quot;./code.png&quot;, &quot;rb&quot;) as f:
    # 方法用于从文件读取指定的字节数
    b = f.read()
# model_type 包含了 ModelType.OCR/ModelType.Captcha 两种
#  ModelType.OCR 可识别光学印刷文本，但是只能单行文字，并且排版需要非常好（不能有很多空白）
# ModelType.Captcha 可识别4-6位验证码，使用的训练模型，很精准，但是不能识别大段文字
sdk = muggle_ocr.SDK(model_type=ModelType.OCR)
# sdk = muggle_ocr.SDK(model_type=ModelType.Captcha)
text = sdk.predict(image_bytes=b)
print(text)

</code></pre>
<h4 id="_4">方案四：使用第三方打码平台</h4>
<pre><code class="language-python"># 超级鹰
</code></pre>
<h3 id="223">2.2.3 代码</h3>
<pre><code class="language-python">import requests
import uuid
import base64
import ddddocr


def fetch_image_code(mobile, app_key, device_identify):
    res = requests.get(
        url=&quot;https://newappuser.jiuxian.com/messages/graphCode.htm&quot;,
        params={
            &quot;appKey&quot;: app_key,
            &quot;appVersion&quot;: &quot;9.1.13&quot;,
            &quot;areaId&quot;: &quot;2707&quot;,
            &quot;channelCode&quot;: &quot;0&quot;,
            &quot;cpsId&quot;: &quot;tencent&quot;,
            &quot;deviceIdentify&quot;: device_identify,
            &quot;deviceType&quot;: &quot;ANDROID&quot;,
            &quot;deviceTypeExtra&quot;: &quot;0&quot;,
            &quot;equipmentType&quot;: &quot;Pixel 2 XL&quot;,
            &quot;mobile&quot;: mobile,
            &quot;netEnv&quot;: &quot;wifi&quot;,
            &quot;screenReslolution&quot;: &quot;1440x2712&quot;,
            &quot;supportWebp&quot;: &quot;1&quot;,
            &quot;sysVersion&quot;: &quot;10&quot;,
            &quot;type&quot;: &quot;4&quot;
        },
        headers={
            &quot;secure&quot;: &quot;false&quot;,
            &quot;Accept-Encoding&quot;: &quot;gzip&quot;,
            'user-agent': &quot;okhttp/3.14.9&quot;,
            'Host': &quot;newappuser.jiuxian.com&quot;,
            'Connection': &quot;keep-alive&quot;
        },
        verify=False
    )

    image_str = res.json()['result'][&quot;imgCode&quot;]

    img = base64.b64decode(image_str)

    ocr = ddddocr.DdddOcr(show_ad=False)
    code = ocr.classification(img)
    return code


def check_image_code(mobile, code, app_key, device_identify):
    res = requests.get(
        url='https://newappuser.jiuxian.com/messages/mobileCode.htm',
        params={
            &quot;appKey&quot;: app_key,
            &quot;appVersion&quot;: &quot;9.1.13&quot;,
            &quot;areaId&quot;: &quot;2707&quot;,
            &quot;channelCode&quot;: &quot;0&quot;,
            &quot;code&quot;: code,
            &quot;cpsId&quot;: &quot;tencent&quot;,
            &quot;deviceIdentify&quot;: device_identify,
            &quot;deviceType&quot;: &quot;ANDROID&quot;,
            &quot;deviceTypeExtra&quot;: &quot;0&quot;,
            &quot;equipmentType&quot;: &quot;Pixel 2 XL&quot;,
            &quot;mobile&quot;: mobile,
            &quot;netEnv&quot;: &quot;wifi&quot;,
            &quot;screenReslolution&quot;: &quot;1440x2712&quot;,
            &quot;supportWebp&quot;: &quot;1&quot;,
            &quot;sysVersion&quot;: &quot;10&quot;,
            &quot;type&quot;: &quot;1&quot;
        },
        verify=False
    )
    data_dict = res.json()

    # {'result': '', 'errCode': '', 'success': '1', 'errMsg': ''}
    # {'result': '', 'errCode': '1200013', 'success': '0', 'errMsg': '验证码输入错误'}
    # print(data_dict)
    return data_dict.get('success') == &quot;1&quot;


def login_by_sms(mobile, sms_code, app_key, device_identify):
    res = requests.post(
        url=&quot;https://newappuser.jiuxian.com/user/loginMobileFast.htm&quot;,
        data={
            &quot;appKey&quot;: app_key,
             &quot;appVersion&quot;: &quot;9.1.13&quot;,
            &quot;areaId&quot;: &quot;2707&quot;,
            &quot;channelCode&quot;: &quot;0&quot;,
            &quot;cpsId&quot;: &quot;tencent&quot;,
            &quot;deviceIdentify&quot;: device_identify,
            &quot;deviceType&quot;: &quot;ANDROID&quot;,
            &quot;deviceTypeExtra&quot;: &quot;0&quot;,
            &quot;equipmentType&quot;: &quot;Pixel 2 XL&quot;,
            &quot;mobile&quot;: mobile,
            &quot;netEnv&quot;: &quot;wifi&quot;,
            &quot;screenReslolution&quot;: &quot;1440x2712&quot;,
            &quot;supportWebp&quot;: &quot;1&quot;,
            &quot;sysVersion&quot;: &quot;10&quot;,
            &quot;verifyCode&quot;: sms_code
        },
        verify=False
    )
    # {&quot;result&quot;:&quot;&quot;,&quot;errCode&quot;:&quot;1200003&quot;,&quot;success&quot;:&quot;0&quot;,&quot;errMsg&quot;:&quot;验证码错误或已过期，请重新输入&quot;}
    # {&quot;result&quot;:{...},&quot;errCode&quot;:&quot;1200093&quot;,&quot;success&quot;:&quot;1&quot;,&quot;errMsg&quot;:&quot;初始化密码&quot;}
    # {&quot;result&quot;:{...},&quot;errCode&quot;:&quot;&quot;,&quot;success&quot;:&quot;1&quot;,&quot;errMsg&quot;:&quot;&quot;}
    data_dict = res.json()
    return data_dict.get(&quot;success&quot;) == &quot;1&quot;, data_dict.get('result')


def run():
    mobile = &quot;18953675221&quot;
    app_key = device_identify = str(uuid.uuid4())
    while True:
        img_code = fetch_image_code(mobile, app_key, device_identify)
        status = check_image_code(mobile, img_code, app_key, device_identify)
        if status:
            break

    sms_code = input(&quot;请输入验证码：&quot;)

    status, data_dict = login_by_sms(mobile, sms_code, app_key, device_identify)
    if not status:
        print(&quot;登录失败&quot;)
        return
    print(&quot;登录成功&quot;)
    print(data_dict)


if __name__ == '__main__':
    run()


'''
{'userInfo': {'apiVersion': 1.0, 'areaId': 500, 'channelCode': '0', 'isClubUser': False, 'isNewUser': False, 'loginUnionFirst': 0, 'loginWay': 2, 'mobile': '18953675221', 'needBindMobile': False, 'rank': 1, 'rankName': '酒虫', 'sex': 0, 'token': '6494ac1cd90b462fbd3c953a69a70861210440860', 'uid': 210440860, 'uname': 'jxw485893769', 'userImg': 'https://misc.jiuxian.com/img/usercenter/sbbgg.jpg'}}

'''
</code></pre>
<h2 id="23">2.3 登录+预约茅台</h2>
<pre><code class="language-python">import requests

import requests
import uuid


def login_by_pwd(mobile, password, app_key, device_identify):
    res = requests.post(
        url=&quot;https://newappuser.jiuxian.com/user/loginUserNamePassWd.htm&quot;,
        data={
            &quot;appKey&quot;: app_key,
            &quot;appVersion&quot;: &quot;9.1.13&quot;,
            &quot;areaId&quot;: &quot;2707&quot;,
            &quot;channelCode&quot;: &quot;0&quot;,
            &quot;cpsId&quot;: &quot;tencent&quot;,
            &quot;deviceIdentify&quot;: device_identify,
            &quot;deviceType&quot;: &quot;ANDROID&quot;,
            &quot;deviceTypeExtra&quot;: &quot;0&quot;,
            &quot;equipmentType&quot;: &quot;Pixel 2 XL&quot;,
            &quot;netEnv&quot;: &quot;wifi&quot;,
            &quot;passWord&quot;: password,
            &quot;screenReslolution&quot;: &quot;1440x2712&quot;,
            &quot;supportWebp&quot;: &quot;1&quot;,
            &quot;sysVersion&quot;: &quot;10&quot;,
            &quot;userName&quot;: mobile
        },
        headers={
            &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,
            &quot;secure&quot;: &quot;false&quot;,
        },
        verify=False
    )
    data_dict = res.json()

    token = data_dict['result']['userInfo']['token']
    return token


def pre_reservation(token, app_key, device_identify):
    res = requests.get(
        url=&quot;https://newappuser.jiuxian.com/reservation/preReservation.htm&quot;,
        params={
            'actId': '1810',
            'appKey': app_key,
            'appVersion': '9.1.13',
            'areaId': '2707',
            'channel': '1',
            'channelCode': '0',
            'cpsId': 'tencent',
            'deviceIdentify': device_identify,
            'deviceType': 'ANDROID',
            'deviceTypeExtra': '    0',
            'equipmentType': 'Pixel 2 XL',
            'lati': '31.088975',
            'longi': '121.58378',
            'netEnv': 'wifi',
            'productId': '626626',
            # 'pushToken': 'AsLMhsufh3YEmpzPv3S5nHhv0pxuModssTVXvf1TSIsp',
            'screenReslolution': '1440x2712',
            'supportWebp': '1',
            'sysVersion': '11',
            'token': token
        },
        verify=False

    )

    data_dict = res.json()
    print(data_dict)


def run():
    app_key = device_identify = str(uuid.uuid4())
    mobile = &quot;18953675221&quot;
    password = &quot;Lqz12345&quot;
    token = login_by_pwd(mobile, password, app_key, device_identify)
    print(token)

    pre_reservation(token, app_key, device_identify)


if __name__ == '__main__':
    run()


 '''
 {'result': {'verificationState': False}, 'errCode': '1200601', 'success': '0', 'errMsg': '您已预约成功，不需重复预约'}

 '''

</code></pre>
<h1 id="_5">三 反调试</h1>
<pre><code class="language-python"># 之前做app，有frida的反调试---》打印所有so文件---》删除检测frida的so文件

# 有些app，在运行的时候，检测frida的相关特征，检测到后就直接退出app----》不允许使用frida调试
    #Frida的Hook
    - 正常去运行APP，无额外的其他特征
    - 正常去运行APP + 运行frida进行Hook【在手机上会生成一个文件】
    有些app内部监测是否有这个文件，如果有这个文件，那么就让app强制停止


# 酒仙网app---》就是检测是否有frida运行的特征：文件

# frida的增强版---》把frida名字改掉---》运行的时候--》没有frida的特征
    strongR-frida-android

# 它不针对所有app，只针对于 检测frida特征的app有效
https://github.com/hzzheyang/strongR-frida-android/releases
跟随 FRIDA 上游自动修补程序，并为 Android 构建反检测版本的 frida-server

# strongR-frida-android 它的本质就是frida-server，只是改了名字
    它的版本跟frida-server是一一对应的
    只要frida-server发一个版本，它一定会跟一个版本

    电脑上要安装frida-server的模块--》跟firda-server版本一一对应
    以后电脑上安装：frida-server的模块 16.1.7 
    firda-server 版本也是：16.1.7 
    strongR-frida-android版本也要是：16.1.7


# 使用步骤：
    1 下载 跟python版本对应的 版本
    2 解压：把解压后的文件推送到手机上
        /data/local/tmp  
        adb push hluda /data/local/tmp/
    3 加执行权限
        # 查看权限
        ls -al
        chomd 755 hluda # 当前文件拥有者 加入可执行权限

        文件   rwx    rwx    rwx
               属主   数组    其它
               421   421     421
                7     5       5
                7     7       7


    4 运行它即可---》以后就把这东西当 frida-server用即可


# 以后可以不使用frida-server了，以后就用hluda 当frida-server用即可
</code></pre>
<p>此时我们可以尝试使用<code>strongR-frida-android</code>来绕过监测。</p>
<p>注意：酒仙网app就可以用它来绕过，但不一定适用所有其他app</p>
<pre><code class="language-python">https://github.com/hzzheyang/strongR-frida-android/releases
</code></pre>
<p><img alt="image-20230905185346306" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20230905185346306.png" /></p>
<pre><code class="language-python"># 下载后，将文件上传，授权
将此处的frida-server解压，并上传到手机的 `/data/local/tmp/`目录，然后赋予可执行权限`chmod 755 文件`。（过程同之前的frida-server的处理）

# 以后使用跟frida-server使用完全相同

</code></pre>
<pre><code class="language-python">



# 枚举手机上的所有进程 &amp; 前台进程
# import frida
#
# # 获取设备信息
# rdev = frida.get_remote_device()
#
# # 枚举所有的进程
# processes = rdev.enumerate_processes()
# for process in processes:
#     print(process)
#
# # 获取在前台运行的APP
# front_app = rdev.get_frontmost_application()
# print(front_app)


# import frida
# import sys
#
# rdev = frida.get_remote_device()
# session = rdev.attach(&quot;酒仙&quot;)
#
# scr = &quot;&quot;&quot;
# Java.perform(function () {
#     var m0 = Java.use(&quot;com.jiuxian.client.util.m0&quot;);
#
#     m0.c.implementation = function(){
#         var res = this.c();
#         console.log('来获取了appKye==&gt;',res);
#     }
# });
# &quot;&quot;&quot;
# script = session.create_script(scr)
#
#
# def on_message(message, data):
#     print(message, data)
#
#
# script.on(&quot;message&quot;, on_message)
#
# script.load()
# sys.stdin.read()


import frida
import sys

rdev = frida.get_remote_device()
pid = rdev.spawn([&quot;com.jiuxianapk.ui&quot;])
session = rdev.attach(pid)

scr = &quot;&quot;&quot;
console.log(&quot;======Start HOOK======&quot;);
Java.perform(function () {
    var LocaleData = Java.use(&quot;libcore.icu.LocaleData&quot;);

    LocaleData.getDateFormat.implementation = function(i){
        console.log('=====&gt;',i);
        var res = this.getDateFormat();
        console.log('=====&gt;',res);
    }
});
&quot;&quot;&quot;
script = session.create_script(scr)


def on_message(message, data):
    print(message, data)


script.on(&quot;message&quot;, on_message)
script.load()
rdev.resume(pid)
sys.stdin.read()




</code></pre>
<h1 id="_6">四 脱壳</h1>
<h2 id="_7">加壳原理</h2>
<pre><code class="language-python"># 把 酒仙app，拖到jadx中，发现加壳了--》反编译不了


# 加壳原理：
    安卓开发：
        java代码+sdk+JNI代码   ----》apk(java代码写的：dex，JNI代码：so文件  资源文件 xml)

    app加壳：
        java代码+sdk+JNI代码--》使用第三方加壳工具---》把dex隐藏到 so文件--》dex很小，so很大

    app运行时：未加壳app
        把dex加载到内存中，执行了

    app运行时：加壳app
        先加载dex--》so文件加载进来---》dex都在so中--》逆操作--》从so中解出dex--》在内存中--》执行逻辑


# 脱壳方案（没有一种脱壳方案适用所有app）
    #手动脱壳（难度大）：
        通过动态调试，跟踪计算Dex源文件的内存偏移地址，从内存中Dump出Dex文件
        难度大，寄存器，汇编，反调试，反读写
    # 工具脱壳：
        HOOK技术/内存特征寻找
        简单易操作
        基于xposed 脱壳工具：
            Fdex2：Hook ClassLoader loadClass方法 通用脱壳
            dumpDex：https://github.com/WrBug/dumpDex
        基于frida的脱壳工具（咱们学习）：
            frida-dexdump：https://github.com/hluwa/FRIDA-DEXDump

        自己定制脱壳机--》aosp刷机后--》自己定制脱壳机
        armPro收费脱壳（花钱）
</code></pre>
<pre><code>pip install frida-dexdump
</code></pre>
<p>想要使用<code>frida-dexdump</code>来进行脱壳，必须做如下两个步骤：</p>
<ul>
<li>
<p>手机端，启动frida-server</p>
</li>
<li>
<p>电脑端</p>
</li>
<li>
<p>端口转发</p>
</li>
<li>
<p>执行脱壳命令</p>
<p><code>python
frida-dexdump  -U -f 包名称</code></p>
</li>
</ul>
<p>脱壳后，会生成相应的dex文件，例如：</p>
<pre><code>frida-dexdump -U -f com.jiuxianapk.ui 
</code></pre>
<p><img alt="image-20221205135214510" src="imgs/day23-%E9%85%92%E4%BB%99%E7%BD%91.assets/image-20221205135214510.png" /></p>
<h2 id="_8">脱壳步骤</h2>
<pre><code class="language-python">## 使用步骤：
1 安装模块[电脑端]：
    pip install frida-dexdump
2 手机端启动frida-server，端口转发

3 执行脱壳命令即可
# frida-dexdump  -U -f 包名称
frida-dexdump -U -f com.jiuxianapk.ui 
frida-dexdump -U -d -f com.jiuxianapk.ui 

4 使用jadx打开下载后的dex即可

5 有时候一次性把dex拖进去会报错
    -某个dex可能不是这个app或这个dex有问题
    -一个个的把dex拖入，哪个报错，就把哪个删除
    -每个dex都可以反编译成一部分java，但是由于下载的dex，某个可能有问题导致整个项目都反编译不了，找出那个有错的dex把它删除即可


### 原理
    只要app运行了---》app就加载到内存中了---》在内存中 原来在so中dex，已经解出来在内存中了--》通过frida-dexdump--》可以去内存中搜索所有dex并下载到本地---》本地会生成很多dex，这些dex就是脱壳后的文件



### 问题
    1 不加壳的app ，可不可以用？
        可以--没有意义

    2 加壳有什么用？
        反编译不出来了
        必须脱壳---》再反编译
</code></pre>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="./js/main.js"></script>
<script src="search/main.js"></script>
<script src="./js/gitbook.min.js"></script>
<script src="./js/theme.min.js"></script>
</body>
</html>