<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>三十、无障碍开发 - My Docs</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">My Docs</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">Welcome to Lucky App逆向</a>
<li class="chapter" data-path="day01-%E5%BC%80%E7%8F%AD/">
<a href="../day01-%E5%BC%80%E7%8F%AD/">一、前期准备</a>
<li class="chapter" data-path="day02-adb/">
<a href="../day02-adb/">二、adb</a>
<li class="chapter" data-path="day03-%E6%8A%93%E5%8C%85%E5%92%8C%E5%8F%8D%E7%BC%96%E8%AF%91/">
<a href="../day03-%E6%8A%93%E5%8C%85%E5%92%8C%E5%8F%8D%E7%BC%96%E8%AF%91/">三、抓包和反编译</a>
<li class="chapter" data-path="day04-hook-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86-%E6%8A%93%E5%8C%85app/">
<a href="../day04-hook-%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86-%E6%8A%93%E5%8C%85app/">四、hook-常用加密-抓包app</a>
<li class="chapter" data-path="day05-%E9%80%86x%E6%A1%88%E4%BE%8B/">
<a href="../day05-%E9%80%86x%E6%A1%88%E4%BE%8B/">五、抓包和逆向案例</a>
<li class="chapter" data-path="day06-java%E5%9F%BA%E7%A1%8001/">
<a href="../day06-java%E5%9F%BA%E7%A1%8001/">六、java基础-01</a>
<li class="chapter" data-path="day07-java%E5%9F%BA%E7%A1%8002/">
<a href="../day07-java%E5%9F%BA%E7%A1%8002/">七、java基础02</a>
<li class="chapter" data-path="day08-java%E5%9F%BA%E7%A1%8003/">
<a href="../day08-java%E5%9F%BA%E7%A1%8003/">八、java基础03</a>
<li class="chapter" data-path="day09-%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%9101/">
<a href="../day09-%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%9101/">Day09 安卓开发01</a>
<li class="chapter" data-path="day10-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%8002/">
<a href="../day10-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%8002/">十、安卓开发02</a>
<li class="chapter" data-path="day10%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8/">
<a href="../day10%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8/">十、安卓基础加密拦截器</a>
<li class="chapter" data-path="day11-C%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85/">
<a href="../day11-C%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85/">十一、C语言安装与入门</a>
<li class="chapter" data-path="day12-C%E8%AF%AD%E8%A8%80%E5%92%8CJNI%E5%BC%80%E5%8F%91/">
<a href="../day12-C%E8%AF%AD%E8%A8%80%E5%92%8CJNI%E5%BC%80%E5%8F%91/">十二、C语言和JNI开发</a>
<li class="chapter" data-path="day13-JNI%E5%BC%80%E5%8F%91/">
<a href="../day13-JNI%E5%BC%80%E5%8F%91/">十三、JNI开发</a>
<li class="chapter" data-path="day14-%E8%BD%A6%E6%99%BA%E8%B5%A2/">
<a href="../day14-%E8%BD%A6%E6%99%BA%E8%B5%A2/">十四、车智赢</a>
<li class="chapter" data-path="day15-%E8%AF%86%E8%B4%A7app/">
<a href="../day15-%E8%AF%86%E8%B4%A7app/">十五、识货app</a>
<li class="chapter" data-path="day16-%E5%BE%97%E7%89%A9app/">
<a href="../day16-%E5%BE%97%E7%89%A9app/">十六、得物app</a>
<li class="chapter" data-path="day17-B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8Fday01/">
<a href="../day17-B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8Fday01/">十七、B站播放量day01</a>
<li class="chapter" data-path="day18-B%E7%AB%9902/">
<a href="../day18-B%E7%AB%9902/">十八、B站02</a>
<li class="chapter" data-path="day19-B%E7%AB%9903/">
<a href="../day19-B%E7%AB%9903/">十九、B站02</a>
<li class="chapter" data-path="day20-%E5%94%AF%E5%93%81%E4%BC%9A01/">
<a href="../day20-%E5%94%AF%E5%93%81%E4%BC%9A01/">二十、唯品会01</a>
<li class="chapter" data-path="day21-%E5%94%AF%E5%93%81%E4%BC%9A02/">
<a href="../day21-%E5%94%AF%E5%93%81%E4%BC%9A02/">二十一、唯品会02</a>
<li class="chapter" data-path="day22-DYM/">
<a href="../day22-DYM/">二十二、DYM</a>
<li class="chapter" data-path="day23-%E9%85%92%E4%BB%99%E7%BD%91/">
<a href="../day23-%E9%85%92%E4%BB%99%E7%BD%91/">二十三、酒仙网</a>
<li class="chapter" data-path="day24-%E5%8F%B8%E5%B0%8F%E5%AE%9D/">
<a href="../day24-%E5%8F%B8%E5%B0%8F%E5%AE%9D/">二十四、司小宝</a>
<li class="chapter" data-path="day25-unidbg-%E4%B8%8A/">
<a href="../day25-unidbg-%E4%B8%8A/">二十五、unidbg-上</a>
<li class="chapter" data-path="day26-unidbg-%E4%B8%AD%E7%AF%87/">
<a href="../day26-unidbg-%E4%B8%AD%E7%AF%87/">二十六、unidbg-中</a>
<li class="chapter" data-path="day27-unidbg-%E4%B8%8B/">
<a href="../day27-unidbg-%E4%B8%8B/">二十七、unidbg-下</a>
<li class="chapter" data-path="day28-xhs-%E4%B8%8A/">
<a href="../day28-xhs-%E4%B8%8A/">二十八、xhs-上</a>
<li class="chapter" data-path="day29-xhs-%E4%B8%8B/">
<a href="../day29-xhs-%E4%B8%8B/">二十九、xhs-下</a>
<li class="chapter active" data-path="day30-%E6%97%A0%E9%9A%9C%E7%A2%8D/">
<a href="./">三十、无障碍开发</a>
<li class="chapter" data-path="day31-%E6%97%A0%E9%9A%9C%E7%A2%8D/">
<a href="../day31-%E6%97%A0%E9%9A%9C%E7%A2%8D/">三十一、无障碍image-20240703160302051</a>
<li class="chapter" data-path="day32-%E6%97%A0%E9%9A%9C%E7%A2%8D%E9%83%A8%E7%BD%B2/">
<a href="../day32-%E6%97%A0%E9%9A%9C%E7%A2%8D%E9%83%A8%E7%BD%B2/">三十二、无障碍项目部署</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="_1">三十、无障碍开发</h1>
<p>无障碍开发，编写一个自己的安卓APP并开启无障碍服务，然后APP就可以实现去控制手机中的其他APP。很多的群控软件都是基于无障碍开发实现。</p>
<p>例如：抖音的自动评论工具。</p>
<p><img alt="image-20240702170022431" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240702170022431.png" /></p>
<h1 id="1">1.常见版本</h1>
<p><img alt="image-20240702171725022" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240702171725022.png" /></p>
<p><img alt="image-20240702171733937" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240702171733937.png" /></p>
<h1 id="2">2.环境准备</h1>
<ul>
<li>Android Studio【2020.3.1.24】</li>
</ul>
<p>```
  https://developer.android.google.cn/studio/archive</p>
<p>Android Studio Arctic Fox | 2020.3.1 Patch 2 September 1, 2021
     Windows (64-bit): android-studio-2020.3.1.24-windows.exe (957.2 MB)
          Mac (Intel): android-studio-2020.3.1.24-mac.zip (997.2 MB)
  Mac (Apple silicon): android-studio-2020.3.1.24-mac_arm.dmg (993.3 MB)</p>
<p>其他airtest
    https://airtest-new.nie.netease.com/update/airtestide
  ```</p>
<ul>
<li>一部安卓手机【无需ROOT】</li>
</ul>
<p><code>本节以红米note9 Pro为例</code></p>
<ul>
<li>抖音 v29.8.0</li>
</ul>
<p><code>https://www.wandoujia.com/apps/7461948/history_v290801</code></p>
<h1 id="3">3.单机版</h1>
<h2 id="31">3.1 创建项目</h2>
<p><img alt="image-20240703103311205" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703103311205.png" /></p>
<p><img alt="image-20240703103346105" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703103346105.png" /></p>
<pre><code>implementation 'androidx.appcompat:appcompat:1.4.1'
implementation 'com.google.android.material:material:1.6.0'
</code></pre>
<h2 id="32">3.2 无障碍服务</h2>
<p><img alt="image-20240703104640834" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703104640834.png" /></p>
<p>app中如果想要支持无障碍服务，需要先进行配置+编写无障碍服务相关的类。</p>
<ul>
<li>配置【AndroidManifest.xml】</li>
</ul>
<p>```xml
  <!-- 注册辅助功能服务 --></p>
<p><service
           android:name=".LuckyAccessibilityService"
           android:enabled="true"
           android:exported="true"
           android:label="抖音直播助手"
           android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE">
      <intent-filter>
          <action android:name="android.accessibilityservice.AccessibilityService" />
      </intent-filter>
      <meta-data
                 android:name="android.accessibilityservice"
                 android:resource="@xml/accessibility_config" />
  </service>
  <!-- 注册辅助功能服务 --></p>
<p>```</p>
<ul>
<li>配置【xml/accessibility_config】</li>
</ul>
<p>```xml
  <?xml version="1.0" encoding="utf-8"?></p>
<p><accessibility-service xmlns:android="http://schemas.android.com/apk/res/android"
      android:accessibilityEventTypes="typeAllMask"
      android:accessibilityFeedbackType="feedbackSpoken"
      android:accessibilityFlags="flagIncludeNotImportantViews|flagReportViewIds"
      android:canPerformGestures="true"
      android:canRetrieveWindowContent="true"
      android:description="@string/accessibility_desc"
      android:notificationTimeout="100" />
  ```</p>
<ul>
<li>配置【values/strings.xml】</li>
</ul>
<p><code>xml
  &lt;resources&gt;
      &lt;string name="app_name"&gt;AutoDemo&lt;/string&gt;
      &lt;string name="accessibility_desc"&gt;智能一点一点&lt;/string&gt;
  &lt;/resources&gt;</code></p>
<ul>
<li>LuckyAccessibilityService</li>
</ul>
<p>```java
  package com.nb.autodemo;</p>
<p>import android.accessibilityservice.AccessibilityService;
  import android.view.accessibility.AccessibilityEvent;</p>
<p>public class LuckyAccessibilityService extends AccessibilityService {
      @Override
      public void onAccessibilityEvent(AccessibilityEvent event) {</p>
<pre><code>  }

  @Override
  public void onInterrupt() {

  }
</code></pre>
<p>}
  ```</p>
<p>将上述代码编写好，再次启动APP时，在安卓手机的无障碍模式中，就会出现我们的服务。</p>
<p><img alt="image-20240703141849036" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703141849036.png" /></p>
<p>当启动无障碍服务之后，onAccessibilityEvent 方法就会被触发执行，可以在此处编写控制其他app的代码。</p>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;

public class LuckyAccessibilityService extends AccessibilityService {
    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        Log.e(&quot;无障碍&quot;,&quot;测试运行中&quot;);
    }

    @Override
    public void onInterrupt() {

    }
}
</code></pre>
<p><img alt="image-20240703110340960" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703110340960.png" /></p>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;

public class LuckyAccessibilityService extends AccessibilityService {

    public static boolean running = false;

    @Override
    public void onInterrupt() {

    }
    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        if (!running) {
            running = true;

            Log.e(&quot;无障碍&quot;, &quot;测试运行中&quot;);
        }
    }
}
</code></pre>
<p><img alt="image-20240703111820565" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703111820565.png" /></p>
<h2 id="33">3.3 引导服务</h2>
<p>启动APP时，检测如果未开启无障碍服务，则自动进入手机APP的无障碍页面，去开启无障碍服务。</p>
<p>这样就不需要每次都去手动找到无障碍服务再启动了。</p>
<pre><code class="language-java">package com.nb.autodemo;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.provider.Settings;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        // 引导用户开启无障碍
        checkAccessibility();
    }


    /**
     * 引导开启无障碍模式
     */
    private void checkAccessibility() {
        if (!isAccessibilitySettingsOn(getApplicationContext())) {
            // 进入无障碍页面，去开启服务
            startActivity(new Intent(Settings.ACTION_ACCESSIBILITY_SETTINGS));
        }
    }

    private boolean isAccessibilitySettingsOn(Context mContext) {
        int accessibilityEnabled = 0;
        final String service = getPackageName() + &quot;/&quot; + LuckyAccessibilityService.class.getCanonicalName();
        try {
            accessibilityEnabled = Settings.Secure.getInt(
                    mContext.getApplicationContext().getContentResolver(),
                    android.provider.Settings.Secure.ACCESSIBILITY_ENABLED);
        } catch (Settings.SettingNotFoundException e) {
            Log.e(&quot;主界面&quot;, &quot;配置文件没找到: &quot; + e.getMessage());
        }

        TextUtils.SimpleStringSplitter mStringColonSplitter = new TextUtils.SimpleStringSplitter(':');
        if (accessibilityEnabled == 1) {
            String settingValue = Settings.Secure.getString(
                    mContext.getApplicationContext().getContentResolver(),
                    Settings.Secure.ENABLED_ACCESSIBILITY_SERVICES);
            if (settingValue != null) {
                mStringColonSplitter.setString(settingValue);
                while (mStringColonSplitter.hasNext()) {
                    String accessibilityService = mStringColonSplitter.next();
                    if (accessibilityService.equalsIgnoreCase(service)) {
                        return true;
                    }
                }
            }
        }
        return false;
    }
}
</code></pre>
<h2 id="34">3.4 开始按钮</h2>
<p>当启动无障碍服务之后 <code>LuckyAccessibilityService</code> 的 <code>onAccessibilityEvent</code>方法就会被出发执行（太快了）</p>
<p>所以，可以在我们自己的应用中定义一个按钮，用按钮当开关，来控制无障碍业务代码的执行。</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    tools:context=&quot;.MainActivity&quot;&gt;

    &lt;Button
        android:id=&quot;@+id/btn_start&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginRight=&quot;5dp&quot;
        android:text=&quot;启动&quot; /&gt;

&lt;/LinearLayout&gt;
</code></pre>
<pre><code class="language-java">package com.nb.autodemo;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.provider.Settings;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {
    private Button btnStart;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        initView();
        initListener();
        // 引导用户开启无障碍
        checkAccessibility();
    }


    private void initView() {
        btnStart = findViewById(R.id.btn_start);
    }

    private void initListener() {
        btnStart.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                start();
            }
        });
    }
    private void start() {
        LuckyAccessibilityService.allowStart = true;
    }

    /**
     * 引导开启无障碍模式
     */
    private void checkAccessibility() {
        if (!isAccessibilitySettingsOn(getApplicationContext())) {
            Toast.makeText(this, &quot;请先打开无障碍服务&quot;, Toast.LENGTH_LONG).show();
            startActivity(new Intent(Settings.ACTION_ACCESSIBILITY_SETTINGS));
        }
    }

    private boolean isAccessibilitySettingsOn(Context mContext) {
        int accessibilityEnabled = 0;
        final String service = getPackageName() + &quot;/&quot; + LuckyAccessibilityService.class.getCanonicalName();
        try {
            accessibilityEnabled = Settings.Secure.getInt(
                    mContext.getApplicationContext().getContentResolver(),
                    android.provider.Settings.Secure.ACCESSIBILITY_ENABLED);
        } catch (Settings.SettingNotFoundException e) {
            Log.e(&quot;主界面&quot;, &quot;配置文件没找到: &quot; + e.getMessage());
        }

        TextUtils.SimpleStringSplitter mStringColonSplitter = new TextUtils.SimpleStringSplitter(':');
        if (accessibilityEnabled == 1) {
            String settingValue = Settings.Secure.getString(
                    mContext.getApplicationContext().getContentResolver(),
                    Settings.Secure.ENABLED_ACCESSIBILITY_SERVICES);
            if (settingValue != null) {
                mStringColonSplitter.setString(settingValue);
                while (mStringColonSplitter.hasNext()) {
                    String accessibilityService = mStringColonSplitter.next();
                    if (accessibilityService.equalsIgnoreCase(service)) {
                        return true;
                    }
                }
            }
        }
        return false;
    }
}
</code></pre>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;

public class LuckyAccessibilityService extends AccessibilityService {

    public static boolean allowStart = false;
    public static boolean running = false;

    @Override
    public void onInterrupt() {

    }

    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        if (!allowStart) {
            return;
        }

        if (!running) {
            running = true;

            Log.e(&quot;无障碍&quot;, &quot;测试运行中&quot;);
        }

    }

}
</code></pre>
<h2 id="35">3.5 启动线程执行</h2>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;
import android.view.accessibility.AccessibilityNodeInfo;

import java.util.List;

public class LuckyAccessibilityService extends AccessibilityService {

    public static boolean allowStart = false;
    public static boolean running = false;

    public static Thread runThread = null;

    @Override
    public void onInterrupt() {

    }

    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        if (!allowStart) {
            return;
        }

        if (!running) {
            running = true;

            // 创建线程
            runThread = new Thread(new Runnable() {
                @Override
                public void run() {
                    loopTask();
                }
            });
            runThread.start();
        }

    }

    public void loopTask() {
        while (true) {
            try {
                Log.e(&quot;无障碍&quot;, &quot;开始运行&quot;);
                Thread.sleep(2000);

            } catch (Exception ex) {
                 Log.e(&quot;异常&quot;, ex.toString());
                ex.printStackTrace();
            }
        }
    }
}
</code></pre>
<h2 id="36">3.6 无障碍：清除应用</h2>
<p><img alt="image-20240703144542761" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703144542761.png" /></p>
<p>先将我们的无障碍应用保护起来，然后用无障碍的代码执行操作：</p>
<ul>
<li>返回主页</li>
</ul>
<p><code>performGlobalAction(GLOBAL_ACTION_HOME);</code></p>
<ul>
<li>打开最近应用</li>
</ul>
<p><code>performGlobalAction(GLOBAL_ACTION_RECENTS);</code></p>
<ul>
<li>清除所有其他的应用
  <img alt="image-20240703143445320" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703143445320.png" />
  <img alt="image-20240703143616359" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703143616359.png" /></li>
</ul>
<p>```java
  Log.e("无障碍", "开始运行");
  Thread.sleep(2000);</p>
<p>// 回到首页 Home
  performGlobalAction(GLOBAL_ACTION_HOME);
  Thread.sleep(2000);</p>
<p>// 打开最近应用
  performGlobalAction(GLOBAL_ACTION_RECENTS);
  Thread.sleep(2000);</p>
<p>// 寻找标签 com.android.systemui:id/clearAnimView
  AccessibilityNodeInfo root = getRootInActiveWindow();
  List<AccessibilityNodeInfo> nodeList = root.findAccessibilityNodeInfosByViewId("com.android.systemui:id/clearAnimView");
  AccessibilityNodeInfo node = nodeList.get(0);
  Thread.sleep(2000);</p>
<p>// 点击标签
  node.performAction(AccessibilityNodeInfo.ACTION_CLICK);
  node.recycle();
  ```</p>
<p>示例代码：</p>
<p>```java
  package com.nb.autodemo;</p>
<p>import android.accessibilityservice.AccessibilityService;
  import android.util.Log;
  import android.view.accessibility.AccessibilityEvent;
  import android.view.accessibility.AccessibilityNodeInfo;</p>
<p>import java.util.List;</p>
<p>public class LuckyAccessibilityService extends AccessibilityService {</p>
<pre><code>  public static boolean allowStart = false;
  public static boolean running = false;

  public static Thread runThread = null;

  @Override
  public void onInterrupt() {

  }

  @Override
  public void onAccessibilityEvent(AccessibilityEvent event) {
      if (!allowStart) {
          return;
      }

      if (!running) {
          running = true;

          // 创建线程
          runThread = new Thread(new Runnable() {
              @Override
              public void run() {
                  loopTask();
              }
          });
          runThread.start();
      }

  }

  public void loopTask() {
      while (true) {
          try {
              Log.e("无障碍", "开始运行");
              Thread.sleep(2000);

              // 回到首页 Home
              performGlobalAction(GLOBAL_ACTION_HOME);
              Thread.sleep(2000);

              // 打开最近应用
              performGlobalAction(GLOBAL_ACTION_RECENTS);
              Thread.sleep(2000);

              // 寻找标签 com.android.systemui:id/clearAnimView
              /*
              AccessibilityNodeInfo root = getRootInActiveWindow();
              List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByViewId("com.android.systemui:id/clearAnimView");
              AccessibilityNodeInfo node = nodeList.get(0);
              */
              AccessibilityNodeInfo killAllNode = findNodeById("com.android.systemui:id/clearAnimView");
              if (killAllNode == null) {
                  continue;
              }
              Thread.sleep(2000);

              // 点击标签
              /*
              node.performAction(AccessibilityNodeInfo.ACTION_CLICK);
              node.recycle();
              */
              clickByNodeClickable(killAllNode);


          } catch (Exception ex) {
              Log.e("异常", ex.toString());
              ex.printStackTrace();
          }
      }
  }

  /**
   * 根据ID找元素
   */
  private AccessibilityNodeInfo findNodeById(String id) {
      AccessibilityNodeInfo root = getRootInActiveWindow();
      if (root == null) {
          return null;
      }
      List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByViewId(id);
      if (nodeList != null) {
          for (int i = 0; i &lt; nodeList.size(); i++) {
              AccessibilityNodeInfo node = nodeList.get(i);
              if (node != null) {
                  return node;
              }
          }
      }
      return null;
  }

  /**
   * 点击节点
   */
  private void clickByNodeClickable(AccessibilityNodeInfo node) {
      if (node.isClickable()) {
          node.performAction(AccessibilityNodeInfo.ACTION_CLICK);
          node.recycle();
      } else {
          AccessibilityNodeInfo parent = node.getParent();
          node.recycle();
          clickByNodeClickable(parent);
      }
  }
</code></pre>
<p>}
  ```</p>
<h2 id="37">3.7 无障碍：启动抖音</h2>
<p>根据app名称【抖音】寻找app并点击。</p>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.accessibilityservice.GestureDescription;
import android.graphics.Path;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;
import android.view.accessibility.AccessibilityNodeInfo;

import java.util.List;

public class LuckyAccessibilityService extends AccessibilityService {

    public static boolean allowStart = false;
    public static boolean running = false;

    public static Thread runThread = null;

    @Override
    public void onInterrupt() {

    }

    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        if (!allowStart) {
            return;
        }

        if (!running) {
            running = true;

            // 创建线程
            runThread = new Thread(new Runnable() {
                @Override
                public void run() {
                    loopTask();
                }
            });
            runThread.start();
        }

    }

    public void loopTask() {
        while (true) {
            try {
                Log.e(&quot;无障碍&quot;, &quot;开始运行&quot;);

                // 关闭所有其他应用
                killAllProcess();

                // 寻找抖音并打开
                Thread.sleep(5000);
                if (!launchApplicationByName(&quot;抖音&quot;, 10)) {
                    Log.e(&quot;无障碍&quot;, &quot;无法启动抖音&quot;);
                    continue;
                }

            } catch (Exception ex) {
                Log.e(&quot;异常&quot;, ex.toString());
                ex.printStackTrace();
            }
        }
    }

    /**
     * 在页面上寻找名字叫啥的app
     */
    public boolean launchApplicationByName(String name, int retry) throws InterruptedException {

        performGlobalAction(GLOBAL_ACTION_HOME);

        for (int i = 0; i &lt; retry; i++) {
            // 翻看右边的页面
            slideScreen(540, 800, 500, 800, 500L, 200L);
            Thread.sleep(3000);

            // 找抖音APP
            AccessibilityNodeInfo app = findNodeByText(name);
            if (app != null) {
                Thread.sleep(500);
                clickByNodeClickable(app);
                Thread.sleep(5000);
                return true;
            }
        }
        return false;
    }


    /**
     * 滑动屏幕
     */
    private boolean slideScreen(int startX, int startY, int endX, int endY, Long startTime, Long duration) {
        try {
            Path path = new Path();
            path.moveTo(startX, startY);
            path.lineTo(endX, endY);
            GestureDescription.Builder builder = new GestureDescription.Builder();
            // GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 500L, 37L)).build();
            // GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 1000L, 500L)).build();
            GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, startTime, duration)).build();
            dispatchGesture(description, null, null);
            return true;
        } catch (Exception e) {
            // Log.e(TAG, &quot;滑动屏幕失败，详细：&quot; + e.toString());
            Log.e(&quot;无障碍&quot;, &quot;滑动屏幕失败&quot;);
        }
        return false;
    }

    /**
     * 杀死所有进程（记得提前锁定无障碍应用）
     */
    public void killAllProcess() throws InterruptedException {
        // 回到首页
        Thread.sleep(2000);
        performGlobalAction(GLOBAL_ACTION_HOME);
        Thread.sleep(2000);
        performGlobalAction(GLOBAL_ACTION_HOME);
        Thread.sleep(2000);

        // 打开最近应用
        performGlobalAction(GLOBAL_ACTION_RECENTS);
        Thread.sleep(2000);

        String[] clearAppIdArray = new String[]{
                &quot;com.huawei.android.launcher:id/clear_all_recents_image_button&quot;, // 华为v30 pro
                &quot;com.hihonor.android.launcher:id/clear_all_recents_image_button&quot;, // 荣耀
                &quot;com.android.systemui:id/clearAnimView&quot; // 小米8A
        };
        for (String id : clearAppIdArray) {
            // 根据ID找到节点
            AccessibilityNodeInfo clearIdNode = findNodeById(id);
            if (clearIdNode != null) {
                // 点击标签
                clickByNodeClickable(clearIdNode);
                break;
            }
        }
    }

    /**
     * 根据文本找元素
     */
    private AccessibilityNodeInfo findNodeByText(String text) {
        AccessibilityNodeInfo root = getRootInActiveWindow();
        if (root == null) {
            return null;
        }
        List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByText(text);
        if (nodeList != null) {
            for (int i = 0; i &lt; nodeList.size(); i++) {
                AccessibilityNodeInfo node = nodeList.get(i);
                if (node != null) {
                    return node;
                }
            }
        }
        return null;
    }


    /**
     * 根据ID找元素
     */
    private AccessibilityNodeInfo findNodeById(String id) {
        AccessibilityNodeInfo root = getRootInActiveWindow();
        if (root == null) {
            return null;
        }
        List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByViewId(id);
        if (nodeList != null) {
            for (int i = 0; i &lt; nodeList.size(); i++) {
                AccessibilityNodeInfo node = nodeList.get(i);
                if (node != null) {
                    return node;
                }
            }
        }
        return null;
    }

    /**
     * 点击节点
     */
    private void clickByNodeClickable(AccessibilityNodeInfo node) {
        if (node.isClickable()) {
            node.performAction(AccessibilityNodeInfo.ACTION_CLICK);
            node.recycle();
        } else {
            AccessibilityNodeInfo parent = node.getParent();
            node.recycle();
            clickByNodeClickable(parent);
        }
    }
}
</code></pre>
<h2 id="38">3.8 无障碍：点击搜索</h2>
<pre><code class="language-java">AccessibilityNodeInfo searchNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/kq3&quot;);
if (searchNode == null) {
    continue;
}
clickByNodeClickable(searchNode);
</code></pre>
<p><img alt="image-20240703151118720" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703151118720.png" /></p>
<h2 id="39">3.9 无障碍：输入直播间</h2>
<p><img alt="image-20240703152322500" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703152322500.png" /></p>
<pre><code>7- #在抖音，记录美好生活#【吕行舞蹈（下午场）】正在直播，来和我一起支持Ta吧。复制下方链接，打开【抖音】，直接观看直播！ https://v.douyin.com/i6HN3SCa/ 7@9.com :0pm
</code></pre>
<pre><code class="language-java">Thread.sleep(randomInt(5, 10) * 1000L);
AccessibilityNodeInfo searchTextNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/et_search_kw&quot;);
Bundle arguments = new Bundle();
String address = &quot;7- #在抖音，记录美好生活#【吕行舞蹈（下午场）】正在直播，来和我一起支持Ta吧。复制下方链接，打开【抖音】，直接观看直播！ https://v.douyin.com/i6HN3SCa/ 7@9.com :0pm&quot;
arguments.putString(AccessibilityNodeInfoCompat.ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE, response.address);
searchTextNode.performAction(AccessibilityNodeInfoCompat.ACTION_SET_TEXT, arguments);
</code></pre>
<p><img alt="image-20240703152439429" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703152439429.png" /></p>
<p>示例代码：</p>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.accessibilityservice.GestureDescription;
import android.graphics.Path;
import android.os.Bundle;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;
import android.view.accessibility.AccessibilityNodeInfo;

import androidx.core.view.accessibility.AccessibilityNodeInfoCompat;

import java.util.List;

public class LuckyAccessibilityService extends AccessibilityService {

    public static boolean allowStart = false;
    public static boolean running = false;

    public static Thread runThread = null;

    @Override
    public void onInterrupt() {

    }

    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        if (!allowStart) {
            return;
        }

        if (!running) {
            running = true;

            // 创建线程
            runThread = new Thread(new Runnable() {
                @Override
                public void run() {
                    loopTask();
                }
            });
            runThread.start();
        }

    }

    public void loopTask() {
        while (true) {
            try {
                Log.e(&quot;无障碍&quot;, &quot;开始运行&quot;);

                // 关闭所有其他应用
                killAllProcess();

                // 寻找抖音并打开
                Thread.sleep(5000);
                if (!launchApplicationByName(&quot;抖音&quot;, 10)) {
                    Log.e(&quot;无障碍&quot;, &quot;无法启动抖音&quot;);
                    continue;
                }

                // 点击搜索
                Thread.sleep(5000);
                AccessibilityNodeInfo searchNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/kq3&quot;);
                if (searchNode == null) {
                    continue;
                }
                clickByNodeClickable(searchNode);


                // 输入直播间分享地址
                Thread.sleep(5 * 1000L);
                AccessibilityNodeInfo searchTextNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/et_search_kw&quot;);
                Bundle arguments = new Bundle();
                String liveAddress = &quot;7- #在抖音，记录美好生活#【吕行舞蹈（下午场）】正在直播，来和我一起支持Ta吧。复制下方链接，打开【抖音】，直接观看直播！ https://v.douyin.com/i6HN3SCa/ 7@9.com :0pm&quot;;
                arguments.putString(AccessibilityNodeInfoCompat.ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE, liveAddress);
                searchTextNode.performAction(AccessibilityNodeInfoCompat.ACTION_SET_TEXT, arguments);

                Thread.sleep(20 * 1000L);

            } catch (Exception ex) {
                Log.e(&quot;异常&quot;, ex.toString());
                ex.printStackTrace();
            }
        }
    }

    /**
     * 在页面上寻找名字叫啥的app
     */
    public boolean launchApplicationByName(String name, int retry) throws InterruptedException {

        performGlobalAction(GLOBAL_ACTION_HOME);

        for (int i = 0; i &lt; retry; i++) {
            // 翻看右边的页面
            slideScreen(540, 800, 500, 800, 500L, 200L);
            Thread.sleep(3000);

            // 找抖音APP
            AccessibilityNodeInfo app = findNodeByText(name);
            if (app != null) {
                Thread.sleep(500);
                clickByNodeClickable(app);
                Thread.sleep(5000);
                return true;
            }
        }
        return false;
    }


    /**
     * 滑动屏幕
     */
    private boolean slideScreen(int startX, int startY, int endX, int endY, Long startTime, Long duration) {
        try {
            Path path = new Path();
            path.moveTo(startX, startY);
            path.lineTo(endX, endY);
            GestureDescription.Builder builder = new GestureDescription.Builder();
            // GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 500L, 37L)).build();
            // GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 1000L, 500L)).build();
            GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, startTime, duration)).build();
            dispatchGesture(description, null, null);
            return true;
        } catch (Exception e) {
            // Log.e(TAG, &quot;滑动屏幕失败，详细：&quot; + e.toString());
            Log.e(&quot;无障碍&quot;, &quot;滑动屏幕失败&quot;);
        }
        return false;
    }

    /**
     * 杀死所有进程（记得提前锁定无障碍应用）
     */
    public void killAllProcess() throws InterruptedException {
        // 1.回到首页 Home
        Thread.sleep(2000);
        performGlobalAction(GLOBAL_ACTION_HOME);
        Thread.sleep(2000);
        performGlobalAction(GLOBAL_ACTION_HOME);
        Thread.sleep(2000);

        // 杀死其他应用
        performGlobalAction(GLOBAL_ACTION_RECENTS);
        Thread.sleep(2000);

        String[] clearAppIdArray = new String[]{
                &quot;com.huawei.android.launcher:id/clear_all_recents_image_button&quot;, // 华为v30 pro
                &quot;com.hihonor.android.launcher:id/clear_all_recents_image_button&quot;, // 荣耀
                &quot;com.android.systemui:id/clearAnimView&quot; // 小米8A
        };
        for (String id : clearAppIdArray) {
            // 根据ID找到节点
            AccessibilityNodeInfo clearIdNode = findNodeById(id);
            if (clearIdNode != null) {
                // 点击标签
                clickByNodeClickable(clearIdNode);
                break;
            }
        }
    }

    /**
     * 根据文本找元素
     */
    private AccessibilityNodeInfo findNodeByText(String text) {
        AccessibilityNodeInfo root = getRootInActiveWindow();
        if (root == null) {
            return null;
        }
        List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByText(text);
        if (nodeList != null) {
            for (int i = 0; i &lt; nodeList.size(); i++) {
                AccessibilityNodeInfo node = nodeList.get(i);
                if (node != null) {
                    return node;
                }
            }
        }
        return null;
    }


    /**
     * 根据ID找元素
     */
    private AccessibilityNodeInfo findNodeById(String id) {
        AccessibilityNodeInfo root = getRootInActiveWindow();
        if (root == null) {
            return null;
        }
        List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByViewId(id);
        if (nodeList != null) {
            for (int i = 0; i &lt; nodeList.size(); i++) {
                AccessibilityNodeInfo node = nodeList.get(i);
                if (node != null) {
                    return node;
                }
            }
        }
        return null;
    }

    /**
     * 点击节点
     */
    private void clickByNodeClickable(AccessibilityNodeInfo node) {
        if (node.isClickable()) {
            node.performAction(AccessibilityNodeInfo.ACTION_CLICK);
            node.recycle();
        } else {
            AccessibilityNodeInfo parent = node.getParent();
            node.recycle();
            clickByNodeClickable(parent);
        }
    }
}
</code></pre>
<h2 id="310">3.10 无障碍：进入直播间</h2>
<p><img alt="image-20240703152930495" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703152930495.png" /></p>
<p>点击搜索，就可以直接进入直播间。</p>
<pre><code class="language-java">// 点击搜索，进入直播间
Thread.sleep(2 * 1000L);
AccessibilityNodeInfo doSearchNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/zy=&quot;);
clickByNodePosition(doSearchNode);


/**
 * 根据坐标 点击
*/
private void clickByNodePosition(AccessibilityNodeInfo node) {

    Rect rc = new Rect();
    node.getBoundsInScreen(rc);
    Path path = new Path();
    path.moveTo(rc.centerX(), rc.centerY());
    GestureDescription.Builder builder = new GestureDescription.Builder();
    GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 0, 200)).build();
    dispatchGesture(description, null, null);
}
</code></pre>
<h2 id="311">3.11 无障碍：输入评论</h2>
<p><img alt="image-20240703154019005" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703154019005.png" /></p>
<p><img alt="image-20240703153949119" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703153949119.png" /></p>
<p><img alt="image-20240703154351840" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703154351840.png" /></p>
<p><img alt="image-20240703154503343" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703154503343.png" /></p>
<pre><code class="language-java">// 找到评论框，并点击
Thread.sleep(5 * 1000L);
// com.ss.android.ugc.aweme:id/f18

// AccessibilityNodeInfo commentNode = findNodeByText(&quot;说点什么...&quot;);
AccessibilityNodeInfo commentNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/f18&quot;);
clickByNodeClickable(commentNode);


// 输入文本
Thread.sleep(5 * 1000L);
AccessibilityNodeInfo sayNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/f4f&quot;);
AccessibilityNodeInfo child = sayNode.getChild(0);
Bundle arguments1 = new Bundle();
arguments1.putString(AccessibilityNodeInfoCompat.ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE, &quot;太漂亮了&quot;);
child.performAction(AccessibilityNodeInfoCompat.ACTION_SET_TEXT, arguments1);

// 点击发送评论
Thread.sleep(5 * 1000L);
AccessibilityNodeInfo sendNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/z0c&quot;);
clickByNodeClickable(sendNode);
</code></pre>
<p><img alt="image-20240703155317625" src="../imgs/day30-%E5%AE%89%E6%8E%92.assets/image-20240703155317625.png" /></p>
<h2 id="312">3.12 整合示例代码</h2>
<pre><code class="language-java">package com.nb.autodemo;

import android.accessibilityservice.AccessibilityService;
import android.accessibilityservice.GestureDescription;
import android.graphics.Path;
import android.graphics.Rect;
import android.os.Bundle;
import android.util.Log;
import android.view.accessibility.AccessibilityEvent;
import android.view.accessibility.AccessibilityNodeInfo;

import androidx.core.view.accessibility.AccessibilityNodeInfoCompat;

import java.util.List;

public class LuckyAccessibilityService extends AccessibilityService {

    public static boolean allowStart = false;
    public static boolean running = false;

    public static Thread runThread = null;

    @Override
    public void onInterrupt() {

    }

    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        if (!allowStart) {
            return;
        }

        if (!running) {
            running = true;

            // 创建线程
            runThread = new Thread(new Runnable() {
                @Override
                public void run() {
                    loopTask();
                }
            });
            runThread.start();
        }

    }

    public void loopTask() {
        while (true) {
            try {
                Log.e(&quot;无障碍&quot;, &quot;开始运行&quot;);

                // 关闭所有其他应用
                killAllProcess();

                // 寻找抖音并打开
                Thread.sleep(5000);
                if (!launchApplicationByName(&quot;抖音&quot;, 10)) {
                    Log.e(&quot;无障碍&quot;, &quot;无法启动抖音&quot;);
                    continue;
                }

                // 点击搜索
                Thread.sleep(5000);
                AccessibilityNodeInfo searchNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/kq3&quot;);
                if (searchNode == null) {
                    continue;
                }
                clickByNodeClickable(searchNode);


                // 输入直播间分享地址
                Thread.sleep(5 * 1000L);
                AccessibilityNodeInfo searchTextNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/et_search_kw&quot;);
                Bundle arguments = new Bundle();
                String liveAddress = &quot;7- #在抖音，记录美好生活#【吕行舞蹈（下午场）】正在直播，来和我一起支持Ta吧。复制下方链接，打开【抖音】，直接观看直播！ https://v.douyin.com/i6HN3SCa/ 7@9.com :0pm&quot;;
                arguments.putString(AccessibilityNodeInfoCompat.ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE, liveAddress);
                searchTextNode.performAction(AccessibilityNodeInfoCompat.ACTION_SET_TEXT, arguments);

                // 点击搜索，进入直播间
                Thread.sleep(2 * 1000L);
                AccessibilityNodeInfo doSearchNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/zy=&quot;);
                clickByNodePosition(doSearchNode);


                // 找到评论框，并点击
                Thread.sleep(5 * 1000L);
                // com.ss.android.ugc.aweme:id/f18
                // AccessibilityNodeInfo commentNode = findNodeByText(&quot;说点什么...&quot;);
                AccessibilityNodeInfo commentNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/f18&quot;);
                clickByNodeClickable(commentNode);


                // 输入文本
                Thread.sleep(5 * 1000L);
                AccessibilityNodeInfo sayNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/f4f&quot;);
                AccessibilityNodeInfo child = sayNode.getChild(0);
                Bundle arguments1 = new Bundle();
                arguments1.putString(AccessibilityNodeInfoCompat.ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE, &quot;太漂亮了&quot;);
                child.performAction(AccessibilityNodeInfoCompat.ACTION_SET_TEXT, arguments1);

                // 点击发送评论
                Thread.sleep(5 * 1000L);
                AccessibilityNodeInfo sendNode = findNodeById(&quot;com.ss.android.ugc.aweme:id/z0c&quot;);
                clickByNodeClickable(sendNode);

                return;

            } catch (Exception ex) {
                Log.e(&quot;异常&quot;, ex.toString());
                ex.printStackTrace();
            }
        }
    }


    /**
     * 根据坐标 点击
     */
    private void clickByNodePosition(AccessibilityNodeInfo node) {

        Rect rc = new Rect();
        node.getBoundsInScreen(rc);
        Path path = new Path();
        path.moveTo(rc.centerX(), rc.centerY());
        GestureDescription.Builder builder = new GestureDescription.Builder();
        GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 0, 200)).build();
        dispatchGesture(description, null, null);
    }

    /**
     * 在页面上寻找名字叫啥的app
     */
    public boolean launchApplicationByName(String name, int retry) throws InterruptedException {

        performGlobalAction(GLOBAL_ACTION_HOME);

        for (int i = 0; i &lt; retry; i++) {
            // 翻看右边的页面
            slideScreen(540, 800, 500, 800, 500L, 200L);
            Thread.sleep(3000);

            // 找抖音APP
            AccessibilityNodeInfo app = findNodeByText(name);
            if (app != null) {
                Thread.sleep(500);
                clickByNodeClickable(app);
                Thread.sleep(5000);
                return true;
            }
        }
        return false;
    }


    /**
     * 滑动屏幕
     */
    private boolean slideScreen(int startX, int startY, int endX, int endY, Long startTime, Long duration) {
        try {
            Path path = new Path();
            path.moveTo(startX, startY);
            path.lineTo(endX, endY);
            GestureDescription.Builder builder = new GestureDescription.Builder();
            // GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 500L, 37L)).build();
            // GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, 1000L, 500L)).build();
            GestureDescription description = builder.addStroke(new GestureDescription.StrokeDescription(path, startTime, duration)).build();
            dispatchGesture(description, null, null);
            return true;
        } catch (Exception e) {
            // Log.e(TAG, &quot;滑动屏幕失败，详细：&quot; + e.toString());
            Log.e(&quot;无障碍&quot;, &quot;滑动屏幕失败&quot;);
        }
        return false;
    }

    /**
     * 杀死所有进程（记得提前锁定无障碍应用）
     */
    public void killAllProcess() throws InterruptedException {
        // 1.回到首页 Home
        Thread.sleep(2000);
        performGlobalAction(GLOBAL_ACTION_HOME);
        Thread.sleep(2000);
        performGlobalAction(GLOBAL_ACTION_HOME);
        Thread.sleep(2000);

        // 杀死其他应用
        performGlobalAction(GLOBAL_ACTION_RECENTS);
        Thread.sleep(2000);

        String[] clearAppIdArray = new String[]{
                &quot;com.huawei.android.launcher:id/clear_all_recents_image_button&quot;, // 华为v30 pro
                &quot;com.hihonor.android.launcher:id/clear_all_recents_image_button&quot;, // 荣耀
                &quot;com.android.systemui:id/clearAnimView&quot; // 小米8A
        };
        for (String id : clearAppIdArray) {
            // 根据ID找到节点
            AccessibilityNodeInfo clearIdNode = findNodeById(id);
            if (clearIdNode != null) {
                // 点击标签
                clickByNodeClickable(clearIdNode);
                break;
            }
        }
    }

    /**
     * 根据文本找元素
     */
    private AccessibilityNodeInfo findNodeByText(String text) {
        AccessibilityNodeInfo root = getRootInActiveWindow();
        if (root == null) {
            return null;
        }
        List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByText(text);
        if (nodeList != null) {
            for (int i = 0; i &lt; nodeList.size(); i++) {
                AccessibilityNodeInfo node = nodeList.get(i);
                if (node != null) {
                    return node;
                }
            }
        }
        return null;
    }


    /**
     * 根据ID找元素
     */
    private AccessibilityNodeInfo findNodeById(String id) {
        AccessibilityNodeInfo root = getRootInActiveWindow();
        if (root == null) {
            return null;
        }
        List&lt;AccessibilityNodeInfo&gt; nodeList = root.findAccessibilityNodeInfosByViewId(id);
        if (nodeList != null) {
            for (int i = 0; i &lt; nodeList.size(); i++) {
                AccessibilityNodeInfo node = nodeList.get(i);
                if (node != null) {
                    return node;
                }
            }
        }
        return null;
    }

    /**
     * 点击节点
     */
    private void clickByNodeClickable(AccessibilityNodeInfo node) {
        if (node.isClickable()) {
            node.performAction(AccessibilityNodeInfo.ACTION_CLICK);
            node.recycle();
        } else {
            AccessibilityNodeInfo parent = node.getParent();
            node.recycle();
            clickByNodeClickable(parent);
        }
    }
}
</code></pre>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../search/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>